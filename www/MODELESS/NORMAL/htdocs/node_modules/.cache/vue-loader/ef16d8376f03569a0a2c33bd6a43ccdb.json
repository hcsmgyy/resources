{"remainingRequest":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\src\\components\\ModalFileInput.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\src\\components\\ModalFileInput.vue","mtime":1624613275271},{"path":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1624613261239},{"path":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\babel-loader\\lib\\index.js","mtime":1624613260275},{"path":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1624613261239},{"path":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\vue-loader\\lib\\index.js","mtime":1624613274496}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgUG9wb3ZlciBmcm9tICJAL2NvbXBvbmVudHMvUG9wb3Zlci52dWUiOw0KaW1wb3J0IHsgY2hlY2tGaWxlRm9ybWF0LCBzaG93RXJyb3JJbmZvLCBjaGVja1NoZWxsUnVsZSB9IGZyb20gIkAvanMvY29tbW9uLmpzIjsNCmV4cG9ydCBkZWZhdWx0IHsNCiAgY29tcG9uZW50czogew0KICAgIFBvcG92ZXIsDQogIH0sDQogIHByb3BzOiB7DQogICAgc2hvd0Rlc2NyaXB0aW9uOiB7IHR5cGU6IEJvb2xlYW4sIGRlZmF1bHQ6IGZhbHNlIH0sDQogICAgZGVzY3JpcHRpb25Db250ZW50OiBTdHJpbmcsDQogICAgbGFiZWxUaXRsZTogU3RyaW5nLA0KICAgIGFjY2VwdEZpbGVUeXBlOiB7IHR5cGU6IFN0cmluZywgZGVmYXVsdDogIiIgfSwNCiAgICBpbXBvcnRCdG5OYW1lOiB7IHR5cGU6IFN0cmluZywgZGVmYXVsdDogIkltcG9ydCIgfSwNCiAgICB1cGxvYWRGdW5jdGlvbjogew0KICAgICAgdHlwZTogRnVuY3Rpb24sDQogICAgICBkZWZhdWx0OiBmdW5jdGlvbiAoKSB7DQogICAgICAgIGNvbnNvbGUubG9nKCJjbGljayBpbXBvcnQiKTsNCiAgICAgIH0sDQogICAgfSwNCiAgICB2YWx1ZTogT2JqZWN0LA0KICAgIG1heFNpemU6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiA1MCAqIDEwMjQgKiAxMDI0IH0sDQogICAgaW1nUmVzb2x1dGlvbldpZHRoOiB7IHR5cGU6IE51bWJlciwgZGVmYXVsdDogLTEgfSwNCiAgICBpbWdSZXNvbHV0aW9uSGVpZ2h0OiB7IHR5cGU6IE51bWJlciwgZGVmYXVsdDogLTEgfSwNCiAgfSwNCiAgbWV0aG9kczogew0KICAgIGJlZm9yZVVwbG9hZDogZnVuY3Rpb24gKGluZm8pIHsNCiAgICAgIC8vY2hlY2sgZm9ybWF0DQogICAgICBsZXQgYWNjZXB0VHlwZXMgPSB0aGlzLmFjY2VwdEZpbGVUeXBlLnNwbGl0KCIsIik7DQogICAgICBsZXQgY2hlY2tTdWNjZXNzID0gZmFsc2U7DQogICAgICBpZiAoIWNoZWNrU2hlbGxSdWxlKGluZm8ubmFtZSkpIHsNCiAgICAgICAgc2hvd0Vycm9ySW5mbyh0aGlzLCB0aGlzLiR0KCJGaWxlTmFtZVNoZWxsRXJyb3IiKSk7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWNjZXB0VHlwZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgaWYgKGNoZWNrRmlsZUZvcm1hdChpbmZvLm5hbWUsIGFjY2VwdFR5cGVzW2ldLCBhY2NlcHRUeXBlc1tpXS5sZW5ndGgpKSB7DQogICAgICAgICAgY2hlY2tTdWNjZXNzID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKCFjaGVja1N1Y2Nlc3MpIHsNCiAgICAgICAgc2hvd0Vycm9ySW5mbyh0aGlzLCB0aGlzLiR0KCJGaWxlRm9ybWF0V2FybmluZyIpKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgICAgLy9jaGVjayBmaWxlIHNpemUNCiAgICAgIGlmICh0aGlzLm1heFNpemUgPiAwICYmIGluZm8uc2l6ZSA+IHRoaXMubWF4U2l6ZSkgew0KICAgICAgICBzaG93RXJyb3JJbmZvKHRoaXMsIHRoaXMuJHQoIlVwbG9hZGluZ0ZpbGVUb29MYXJnZVdhcm5pbmciKSk7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICAgIC8vY2hlY2sgZmlsZSBuYW1lDQogICAgICBpZiAoaW5mby5uYW1lLmxlbmd0aCA+IDEyNykgew0KICAgICAgICBzaG93RXJyb3JJbmZvKHRoaXMsIHRoaXMuJHQoIldhcm5pbmdGaWxlTmFtZVRvb0xvbmciKSk7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCg0KICAgICAgLy9jaGVjayBpbWcgcmVzb2x1dGlvbg0KICAgICAgaWYgKA0KICAgICAgICAoY2hlY2tGaWxlRm9ybWF0KGluZm8ubmFtZSwgIi5QTkciLCA0KSB8fA0KICAgICAgICAgIGNoZWNrRmlsZUZvcm1hdChpbmZvLm5hbWUsICIuSlBHIiwgNCkgfHwNCiAgICAgICAgICBjaGVja0ZpbGVGb3JtYXQoaW5mby5uYW1lLCAiLkpQRUciLCA1KSkgJiYNCiAgICAgICAgdGhpcy5pbWdSZXNvbHV0aW9uV2lkdGggPiAwICYmDQogICAgICAgIHRoaXMuaW1nUmVzb2x1dGlvbkhlaWdodCA+IDANCiAgICAgICkgew0KICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsNCiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoaW5mbyk7DQogICAgICAgIHZhciB2bSA9IHRoaXM7DQogICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOw0KICAgICAgICAgIGltZy5zcmMgPSByZWFkZXIucmVzdWx0Ow0KICAgICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgIGltZy53aWR0aCA+IHZtLmltZ1Jlc29sdXRpb25XaWR0aCB8fA0KICAgICAgICAgICAgICBpbWcuaGVpZ2h0ID4gdm0uaW1nUmVzb2x1dGlvbkhlaWdodA0KICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgIHNob3dFcnJvckluZm8odm0sIHZtLiR0KCJJbWFnZVJlc29sdXRpb25FcnIiKSk7DQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGluZm8uaGVpZ2h0ID0gaW1nLmhlaWdodDsNCiAgICAgICAgICAgICAgaW5mby53aWR0aCA9IGltZy53aWR0aDsNCiAgICAgICAgICAgICAgdm0uZmlsZURhdGEgPSBpbmZvOw0KICAgICAgICAgICAgICB2bS52YWx1ZS5maWxlTmFtZSA9IGluZm8ubmFtZTsNCiAgICAgICAgICAgICAgdm0ub25DaGFuZ2UoKTsNCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH07DQogICAgICAgICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAvL+WbvueJh+WKoOi9vemUmeivrw0KICAgICAgICAgICAgc2hvd0Vycm9ySW5mbyh2bSwgdm0uJHQoIkZpbGVGb3JtYXRXYXJuaW5nIikpOw0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgIH07DQogICAgICAgIH07DQogICAgICB9IGVsc2Ugew0KICAgICAgICAvL2RvbmUNCiAgICAgICAgdGhpcy5maWxlRGF0YSA9IGluZm87DQogICAgICAgIHRoaXMudmFsdWUuZmlsZU5hbWUgPSBpbmZvLm5hbWU7DQogICAgICAgIHRoaXMub25DaGFuZ2UoKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgIH0sDQogICAgb25DaGFuZ2U6IGZ1bmN0aW9uICgpIHsNCiAgICAgIGxldCBkYXRhID0gew0KICAgICAgICBmaWxlTmFtZTogdGhpcy52YWx1ZS5maWxlTmFtZSwNCiAgICAgICAgZmlsZURhdGE6IHRoaXMuZmlsZURhdGEsDQogICAgICB9Ow0KICAgICAgdGhpcy4kZW1pdCgiY2hhbmdlIiwgZGF0YSk7DQogICAgfSwNCiAgICBvbkNhbmNlbDogZnVuY3Rpb24gKCkgew0KICAgICAgdGhpcy52YWx1ZS5maWxlTmFtZSA9IHRoaXMuJHQoIlVwZ3JhZGVGaWxlUGF0aCIpOw0KICAgICAgdGhpcy5maWxlRGF0YSA9IHt9Ow0KICAgICAgdGhpcy5vbkNoYW5nZSgpOw0KICAgIH0sDQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIC8vIGZpbGVOYW1lOiB0aGlzLiR0KCJVcGdyYWRlRmlsZVBhdGgiKSwNCiAgICAgIGZpbGVEYXRhOiB7fSwNCiAgICAgIGltcG9ydEJ0bkRpc2FibGVkOiB0cnVlLA0KICAgIH07DQogIH0sDQogIHdhdGNoOiB7DQogICAgdmFsdWUobmV3VmFsLCBvbGRWYWwpIHsNCiAgICAgIGxldCBmaWxlTmFtZSA9IG5ld1ZhbC5maWxlTmFtZTsNCiAgICAgIGlmIChmaWxlTmFtZSAhPSAiIiAmJiBmaWxlTmFtZSAhPSB0aGlzLiR0KCJVcGdyYWRlRmlsZVBhdGgiKSkgew0KICAgICAgICB0aGlzLmltcG9ydEJ0bkRpc2FibGVkID0gZmFsc2U7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB0aGlzLmltcG9ydEJ0bkRpc2FibGVkID0gdHJ1ZTsNCiAgICAgIH0NCiAgICB9LA0KICB9LA0KfTsNCg=="},{"version":3,"sources":["ModalFileInput.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ModalFileInput.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div class=\"ak-modal-file-input-div\">\r\n    <div>\r\n      <label class=\"ak-modal-file-input-title-label\">{{labelTitle}}</label>\r\n    </div>\r\n    <div :style=\"{display:'flex'}\">\r\n      <div class=\"ak-modal-file-input-file-name\">\r\n        <label>{{value.fileName}}</label>\r\n        <a-upload\r\n          name=\"file\"\r\n          :showUploadList=\"false\"\r\n          :accept=\"acceptFileType\"\r\n          :beforeUpload=\"beforeUpload\"\r\n          :style=\"{float:'right'}\"\r\n        >\r\n          <a-button type=\"file\" class=\"ak-modal-file-input-file-button\">{{$t('UpgradeFile')}}</a-button>\r\n        </a-upload>\r\n      </div>\r\n      <a-button\r\n        type=\"primary\"\r\n        class=\"ak-modal-file-input-btn\"\r\n        @click=\"onCancel\"\r\n        :disabled=\"importBtnDisabled\"\r\n      >\r\n        <MyIcon type=\"iconreset\" :style=\"{fontSize:'16px',paddingRight:'6px'}\"></MyIcon>\r\n        {{ importBtnName }}\r\n      </a-button>\r\n\r\n      <Popover\r\n        :showDescription=\"showDescription\"\r\n        :descriptionContent=\"descriptionContent\"\r\n        :style=\"{paddingLeft:'50px'}\"\r\n      ></Popover>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Popover from \"@/components/Popover.vue\";\r\nimport { checkFileFormat, showErrorInfo, checkShellRule } from \"@/js/common.js\";\r\nexport default {\r\n  components: {\r\n    Popover,\r\n  },\r\n  props: {\r\n    showDescription: { type: Boolean, default: false },\r\n    descriptionContent: String,\r\n    labelTitle: String,\r\n    acceptFileType: { type: String, default: \"\" },\r\n    importBtnName: { type: String, default: \"Import\" },\r\n    uploadFunction: {\r\n      type: Function,\r\n      default: function () {\r\n        console.log(\"click import\");\r\n      },\r\n    },\r\n    value: Object,\r\n    maxSize: { type: Number, default: 50 * 1024 * 1024 },\r\n    imgResolutionWidth: { type: Number, default: -1 },\r\n    imgResolutionHeight: { type: Number, default: -1 },\r\n  },\r\n  methods: {\r\n    beforeUpload: function (info) {\r\n      //check format\r\n      let acceptTypes = this.acceptFileType.split(\",\");\r\n      let checkSuccess = false;\r\n      if (!checkShellRule(info.name)) {\r\n        showErrorInfo(this, this.$t(\"FileNameShellError\"));\r\n        return false;\r\n      }\r\n      for (let i = 0; i < acceptTypes.length; i++) {\r\n        if (checkFileFormat(info.name, acceptTypes[i], acceptTypes[i].length)) {\r\n          checkSuccess = true;\r\n        }\r\n      }\r\n      if (!checkSuccess) {\r\n        showErrorInfo(this, this.$t(\"FileFormatWarning\"));\r\n        return false;\r\n      }\r\n      //check file size\r\n      if (this.maxSize > 0 && info.size > this.maxSize) {\r\n        showErrorInfo(this, this.$t(\"UploadingFileTooLargeWarning\"));\r\n        return false;\r\n      }\r\n      //check file name\r\n      if (info.name.length > 127) {\r\n        showErrorInfo(this, this.$t(\"WarningFileNameTooLong\"));\r\n        return false;\r\n      }\r\n\r\n      //check img resolution\r\n      if (\r\n        (checkFileFormat(info.name, \".PNG\", 4) ||\r\n          checkFileFormat(info.name, \".JPG\", 4) ||\r\n          checkFileFormat(info.name, \".JPEG\", 5)) &&\r\n        this.imgResolutionWidth > 0 &&\r\n        this.imgResolutionHeight > 0\r\n      ) {\r\n        var reader = new FileReader();\r\n        reader.readAsDataURL(info);\r\n        var vm = this;\r\n        reader.onload = function () {\r\n          var img = new Image();\r\n          img.src = reader.result;\r\n          img.onload = function () {\r\n            if (\r\n              img.width > vm.imgResolutionWidth ||\r\n              img.height > vm.imgResolutionHeight\r\n            ) {\r\n              showErrorInfo(vm, vm.$t(\"ImageResolutionErr\"));\r\n              return false;\r\n            } else {\r\n              info.height = img.height;\r\n              info.width = img.width;\r\n              vm.fileData = info;\r\n              vm.value.fileName = info.name;\r\n              vm.onChange();\r\n              return false;\r\n            }\r\n          };\r\n          img.onerror = function () {\r\n            //图片加载错误\r\n            showErrorInfo(vm, vm.$t(\"FileFormatWarning\"));\r\n            return false;\r\n          };\r\n        };\r\n      } else {\r\n        //done\r\n        this.fileData = info;\r\n        this.value.fileName = info.name;\r\n        this.onChange();\r\n        return false;\r\n      }\r\n    },\r\n    onChange: function () {\r\n      let data = {\r\n        fileName: this.value.fileName,\r\n        fileData: this.fileData,\r\n      };\r\n      this.$emit(\"change\", data);\r\n    },\r\n    onCancel: function () {\r\n      this.value.fileName = this.$t(\"UpgradeFilePath\");\r\n      this.fileData = {};\r\n      this.onChange();\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      // fileName: this.$t(\"UpgradeFilePath\"),\r\n      fileData: {},\r\n      importBtnDisabled: true,\r\n    };\r\n  },\r\n  watch: {\r\n    value(newVal, oldVal) {\r\n      let fileName = newVal.fileName;\r\n      if (fileName != \"\" && fileName != this.$t(\"UpgradeFilePath\")) {\r\n        this.importBtnDisabled = false;\r\n      } else {\r\n        this.importBtnDisabled = true;\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.ak-modal-file-input-div {\r\n  padding-left: 110px;\r\n  font-size: 16px;\r\n  margin-top: 25px;\r\n}\r\n\r\n.ak-modal-file-input-title-label {\r\n  max-width: 700px;\r\n  display: inline-block;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n  padding-top: 4px;\r\n  margin-bottom: 26px;\r\n  color: #333333;\r\n}\r\n\r\n.ak-modal-file-input-hint-label {\r\n  color: #9a9a9a;\r\n  margin-left: 10px;\r\n  padding-top: 4px;\r\n}\r\n\r\n.ak-modal-file-input-file-name {\r\n  width: 380px;\r\n  border: 1px solid rgba(201, 201, 201, 1);\r\n  border-radius: 3px;\r\n  height: 32px;\r\n  background: rgba(249, 249, 249, 1);\r\n  color: #999999;\r\n  font-size: 16px;\r\n  padding-left: 16px;\r\n  font-weight: 400;\r\n}\r\n\r\n.ak-modal-file-input-file-button {\r\n  float: right;\r\n  width: 110px;\r\n  border-radius: 3px;\r\n  border: none;\r\n  background: #0087f7;\r\n  font-size: 16px;\r\n  color: #ffffff;\r\n  height: 30px !important;\r\n}\r\n\r\n.ak-modal-file-input-file-name > label {\r\n  display: inline-block;\r\n  margin-top: 2px;\r\n  max-width: 250px;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  white-space: nowrap;\r\n}\r\n\r\n/deep/.ant-btn:hover,\r\n.ant-btn:focus,\r\n.ant-btn:active,\r\n.ant-btn.active {\r\n  background: #0087f7;\r\n  color: #ffffff;\r\n}\r\n\r\n.ak-modal-file-input-btn {\r\n  width: 120px;\r\n  background: #0087f7;\r\n  color: #ffffff;\r\n  font-size: 16px;\r\n  margin-left: 30px;\r\n}\r\n</style>"]}]}