{"remainingRequest":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\thread-loader\\dist\\cjs.js!E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\babel-loader\\lib\\index.js!E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\src\\views\\PhoneDisplaySetting.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\src\\views\\PhoneDisplaySetting.vue","mtime":1624613275300},{"path":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1624613261239},{"path":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1624613273395},{"path":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\babel-loader\\lib\\index.js","mtime":1624613260275},{"path":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1624613261239},{"path":"E:\\workspace\\resources\\www\\MODELESS\\NORMAL\\htdocs\\node_modules\\vue-loader\\lib\\index.js","mtime":1624613274496}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJFOi93b3Jrc3BhY2UvcmVzb3VyY2VzL3d3dy9NT0RFTEVTUy9OT1JNQUwvaHRkb2NzL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eSI7Ci8vCi8vCi8vCi8vCmltcG9ydCBDb21tb25QYWdlIGZyb20gIkAvY29tcG9uZW50cy9Db21tb25QYWdlLnZ1ZSI7CmltcG9ydCB7IHNob3dSZXF1ZXN0U3VjY2VzcywgZGVlcENsb25lLCBjaGVja0ZpbGVGb3JtYXQsIHNob3dFcnJvckluZm8sIGdldEl0ZW1CeUtleSwgZ2V0Q29udGVudEJ5S2V5IH0gZnJvbSAiQC9qcy9jb21tb24uanMiOwppbXBvcnQgeyBnZXRPcHRpb25zQnlMYWJlbCB9IGZyb20gIkAvanMvY29tbW9uS2V5cy5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBDb21tb25QYWdlOiBDb21tb25QYWdlCiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgd2FsbHBhcGVyRmlsZUl0ZW1zOiBbXSwKICAgICAgd2FsbHBhcGVyRmlsZUl0ZW1zQ2FsbDogW10sCiAgICAgIHNjcmVlblNhdmVyVHlwZUl0ZW1zOiBbXSwKICAgICAgc2NyZWVuU2F2ZXJQaWN0dXJlSXRlbXM6IFtdLAogICAgICBzY3JlZW5TYXZlclZpZGVvSXRlbXM6IFtdLAogICAgICB0eXBlSXRlbXM6IFtdLAogICAgICB0eXBlMkl0ZW1zOiBbXSwKICAgICAgYXBwU2VsZWN0SXRlbXM6IFtdLAogICAgICBjaGFuZ2VkQ2ZnRGF0YToge30sCiAgICAgIHN1Ym1pdENmZ0RhdGE6IHt9LAogICAgICBhcGlEYXRhOiB7fSwKICAgICAgZGF0YTogewogICAgICAgIGdldERhdGFTdWNjZXNzOiBmYWxzZQogICAgICB9CiAgICB9OwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIGdldERhdGEodGhpcyk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBvbkNvbW1vblBhZ2VEYXRhQ2hhbmdlOiBmdW5jdGlvbiBvbkNvbW1vblBhZ2VEYXRhQ2hhbmdlKGV2ZW50KSB7CiAgICAgIHNldENoYW5nZWREYXRhKHRoaXMsIGV2ZW50KTsgLy/nlYzpnaLlj5jljJYKCiAgICAgIGhhbmRsZXJQYWdlQ2hhbmdlZCh0aGlzLCBldmVudCk7CiAgICB9CiAgfQp9OwoKZnVuY3Rpb24gc2V0Q2hhbmdlZERhdGEodm0sIGV2ZW50KSB7CiAgaWYgKGV2ZW50LmNvbnRlbnRLZXkgPT0gImhvbWVwYWdlIiAmJiBldmVudC5pdGVtS2V5ID09ICJob21lcGFnZSIpIHsKICAgIHZhciBfdGFibGVEYXRhID0gZXZlbnQubmV3VmFsOwoKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3RhYmxlRGF0YS5sZW5ndGg7IGkrKykgewogICAgICB2bS5jaGFuZ2VkQ2ZnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMUFSRUEiICsgKGkgKyAxKSArICIuRGlzcGxheVR5cGUiXSA9IF90YWJsZURhdGFbaV0udHlwZS52YWx1ZTsKICAgICAgdm0uY2hhbmdlZENmZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTFBUkVBIiArIChpICsgMSkgKyAiLkxBQkVMIl0gPSBfdGFibGVEYXRhW2ldLmxhYmVsLnZhbHVlOwogICAgICB2bS5jaGFuZ2VkQ2ZnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMUFSRUEiICsgKGkgKyAxKSArICIuVmFsdWUiXSA9IF90YWJsZURhdGFbaV0udmFsdWUudmFsdWU7CgogICAgICBpZiAoZXZlbnQubmV3VmFsW2ldLmljb24uZmlsZU5hbWUgIT0gZXZlbnQub2xkVmFsW2ldLmljb24uZmlsZU5hbWUpIHsKICAgICAgICB2bS5jaGFuZ2VkQ2ZnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMUFSRUEiICsgKGkgKyAxKSArICIuSUNPTiJdID0gX3RhYmxlRGF0YVtpXS5pY29uLmZpbGVOYW1lID09IHZtLiR0KCJVcGdyYWRlRmlsZVBhdGgiKSA/ICIiIDogX3RhYmxlRGF0YVtpXS5pY29uLmZpbGVOYW1lOwogICAgICB9CiAgICB9CiAgfSBlbHNlIGlmIChldmVudC5jb250ZW50S2V5ID09ICJtb3JlcGFnZSIgJiYgZXZlbnQuaXRlbUtleSA9PSAibW9yZXBhZ2UiKSB7CiAgICB2YXIgX3RhYmxlRGF0YTIgPSBldmVudC5uZXdWYWw7CgogICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IF90YWJsZURhdGEyLmxlbmd0aDsgX2krKykgewogICAgICB2bS5jaGFuZ2VkQ2ZnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMkFSRUEiICsgKF9pICsgMSkgKyAiLkRpc3BsYXlUeXBlIl0gPSBfdGFibGVEYXRhMltfaV0udHlwZS52YWx1ZTsKICAgICAgdm0uY2hhbmdlZENmZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTJBUkVBIiArIChfaSArIDEpICsgIi5MQUJFTCJdID0gX3RhYmxlRGF0YTJbX2ldLmxhYmVsLnZhbHVlOwogICAgICB2bS5jaGFuZ2VkQ2ZnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMkFSRUEiICsgKF9pICsgMSkgKyAiLlZhbHVlIl0gPSBfdGFibGVEYXRhMltfaV0udmFsdWUudmFsdWU7CgogICAgICBpZiAoZXZlbnQubmV3VmFsW19pXS5pY29uLmZpbGVOYW1lICE9IGV2ZW50Lm9sZFZhbFtfaV0uaWNvbi5maWxlTmFtZSkgewogICAgICAgIHZtLmNoYW5nZWRDZmdEYXRhWyJDb25maWcuSW5kb29yLlBBR0UyQVJFQSIgKyAoX2kgKyAxKSArICIuSUNPTiJdID0gX3RhYmxlRGF0YTJbX2ldLmljb24uZmlsZU5hbWUgPT0gdm0uJHQoIlVwZ3JhZGVGaWxlUGF0aCIpID8gIiIgOiBfdGFibGVEYXRhMltfaV0uaWNvbi5maWxlTmFtZTsKICAgICAgfQogICAgfQogIH0gZWxzZSBpZiAoZXZlbnQuY29udGVudEtleSA9PSAidGhlbWVTZXR0aW5nIikgewogICAgdmFyIHdhbGxwYXBlckl0ZW1zID0gZ2V0SXRlbUJ5S2V5KHZtLmRhdGEsICJ3YWxscGFwZXIiLCAiQ29uZmlnLlNldHRpbmdzLkxPR08uV2FsbHBhcGVyIik7CiAgICB3YWxscGFwZXJJdGVtcy52YWx1ZSA9ICIvc2RjYXJkL1BpY3R1cmVzL3dhbGxwYXBlci9kZWZhdWx0LzcuanBnIjsKICAgIHZtLmNoYW5nZWRDZmdEYXRhWyJDb25maWcuU2V0dGluZ3MuTE9HTy5XYWxscGFwZXIiXSA9ICIvc2RjYXJkL1BpY3R1cmVzL3dhbGxwYXBlci9kZWZhdWx0LzcuanBnIjsKICAgIHZtLmNoYW5nZWRDZmdEYXRhW2V2ZW50Lml0ZW1LZXldID0gZXZlbnQubmV3VmFsOwogIH0gZWxzZSB7CiAgICB2bS5jaGFuZ2VkQ2ZnRGF0YVtldmVudC5pdGVtS2V5XSA9IGV2ZW50Lm5ld1ZhbDsKICB9Cn0KCmZ1bmN0aW9uIGhhbmRsZXJQYWdlQ2hhbmdlZCh2bSwgZXZlbnQpIHsKICAvL3RoZW1lCiAgdmFyIHRoZW1lRGF0YSA9IGdldEl0ZW1CeUtleSh2bS5kYXRhLCAidGhlbWVTZXR0aW5nIiwgIkNvbmZpZy5TZXR0aW5ncy5ESVNQTEFZU1RZTEUuSWRsZVN0eWxlIik7CiAgdmFyIHdhbGxwYXBlckl0ZW1zID0gZ2V0SXRlbUJ5S2V5KHZtLmRhdGEsICJ3YWxscGFwZXIiLCAiQ29uZmlnLlNldHRpbmdzLkxPR08uV2FsbHBhcGVyIik7CiAgdmFyIGhvbWVQYWdlQ29udGVudCA9IGdldENvbnRlbnRCeUtleSh2bS5kYXRhLCAiaG9tZXBhZ2UiKTsKICB2YXIgbW9yZVBhZ2VDb250ZW50ID0gZ2V0Q29udGVudEJ5S2V5KHZtLmRhdGEsICJtb3JlcGFnZSIpOwoKICBpZiAodGhlbWVEYXRhLnZhbHVlID09IDQpIHsKICAgIHdhbGxwYXBlckl0ZW1zLnNlbGVjdEl0ZW1zID0gdm0ud2FsbHBhcGVyRmlsZUl0ZW1zOyAvL+aNouWbvueJhwoKICAgIGhvbWVQYWdlQ29udGVudC5pbWdOYW1lID0gImhvbWVfcGFnZV9kZWZhdWx0LnBuZyI7CiAgICBtb3JlUGFnZUNvbnRlbnQuaW1nTmFtZSA9ICJtb3JlX3BhZ2VfZGVmYXVsdC5wbmciOwogIH0gZWxzZSB7CiAgICB3YWxscGFwZXJJdGVtcy5zZWxlY3RJdGVtcyA9IHZtLndhbGxwYXBlckZpbGVJdGVtc0NhbGw7CiAgICBob21lUGFnZUNvbnRlbnQuaW1nTmFtZSA9ICJob21lX3BhZ2VfY2FsbC5wbmciOwogICAgbW9yZVBhZ2VDb250ZW50LmltZ05hbWUgPSAibW9yZV9wYWdlX2NhbGwucG5nIjsKICB9IC8vaG9tZXBhZ2UKCgogIHZhciBob21lcGFnZUl0ZW0gPSBnZXRJdGVtQnlLZXkodm0uZGF0YSwgImhvbWVwYWdlIiwgImhvbWVwYWdlIik7CiAgdmFyIGhvbWVwYWdlVGFibGVEYXRhID0gaG9tZXBhZ2VJdGVtLnRhYmxlRGF0YTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBob21lcGFnZVRhYmxlRGF0YS5sZW5ndGg7IGkrKykgewogICAgLy90eXBl5piv5ZCm55u45ZCMCiAgICBob21lcGFnZVRhYmxlRGF0YVtpXS50eXBlLmlzV2FybiA9IGZhbHNlOwoKICAgIGZvciAodmFyIGogPSAwOyBqIDwgaG9tZXBhZ2VUYWJsZURhdGEubGVuZ3RoOyBqKyspIHsKICAgICAgaWYgKGkgIT0gaiAmJiBob21lcGFnZVRhYmxlRGF0YVtqXS50eXBlLnZhbHVlID09IGhvbWVwYWdlVGFibGVEYXRhW2ldLnR5cGUudmFsdWUgJiYgaG9tZXBhZ2VUYWJsZURhdGFbal0udHlwZS52YWx1ZSAhPSBnZXRBcmVhVHlwZUJ5TGFiZWwoIkN1c3RvbSBBUEsiLCB2bSkgJiYgaG9tZXBhZ2VUYWJsZURhdGFbal0udHlwZS52YWx1ZSAhPSBnZXRBcmVhVHlwZUJ5TGFiZWwoIkJyb3dzZXIiLCB2bSkgJiYgaG9tZXBhZ2VUYWJsZURhdGFbal0udHlwZS52YWx1ZSAhPSBnZXRBcmVhVHlwZUJ5TGFiZWwoIk4vQSIsIHZtKSkgewogICAgICAgIGhvbWVwYWdlVGFibGVEYXRhW2ldLnR5cGUuaXNXYXJuID0gdHJ1ZTsKICAgICAgICBob21lcGFnZVRhYmxlRGF0YVtqXS50eXBlLmlzV2FybiA9IHRydWU7CiAgICAgIH0KICAgIH0gLy9pY29u5pi+56S65LiO5ZCmCgoKICAgIGlmIChob21lcGFnZVRhYmxlRGF0YVtpXS50eXBlLnZhbHVlID09IGdldEFyZWFUeXBlQnlMYWJlbCgiRE5EIiwgdm0pKSB7CiAgICAgIGhvbWVwYWdlVGFibGVEYXRhW2ldLmljb24uaXNTaG93ID0gZmFsc2U7CiAgICB9IGVsc2UgewogICAgICBob21lcGFnZVRhYmxlRGF0YVtpXS5pY29uLmlzU2hvdyA9IHRydWU7CiAgICB9IC8vbGFiZWzmmK/lkKbnpoHnlKgKCgogICAgaWYgKGhvbWVwYWdlVGFibGVEYXRhW2ldLnR5cGUudmFsdWUgPT0gZ2V0QXJlYVR5cGVCeUxhYmVsKCJETkQiLCB2bSkgfHwgaG9tZXBhZ2VUYWJsZURhdGFbaV0udHlwZS52YWx1ZSA9PSBnZXRBcmVhVHlwZUJ5TGFiZWwoIlVubG9jayIsIHZtKSkgewogICAgICBob21lcGFnZVRhYmxlRGF0YVtpXS5sYWJlbC5kaXNhYmxlZCA9IHRydWU7CiAgICB9IGVsc2UgewogICAgICBob21lcGFnZVRhYmxlRGF0YVtpXS5sYWJlbC5kaXNhYmxlZCA9IGZhbHNlOwogICAgfSAvL3ZhbHVl5piv5ZCm56aB55SoCgoKICAgIGlmIChob21lcGFnZVRhYmxlRGF0YVtpXS50eXBlLnZhbHVlID09IGdldEFyZWFUeXBlQnlMYWJlbCgiQ3VzdG9tIEFQSyIsIHZtKSB8fCBob21lcGFnZVRhYmxlRGF0YVtpXS50eXBlLnZhbHVlID09IGdldEFyZWFUeXBlQnlMYWJlbCgiQnJvd3NlciIsIHZtKSkgewogICAgICBob21lcGFnZVRhYmxlRGF0YVtpXS52YWx1ZS5kaXNhYmxlZCA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgaG9tZXBhZ2VUYWJsZURhdGFbaV0udmFsdWUuZGlzYWJsZWQgPSB0cnVlOwogICAgfSAvL3ZhbHVl5YC855qEaW5wdXTlkoxzZWxlY3TmoYblj5jmjaIKCgogICAgaWYgKGhvbWVwYWdlVGFibGVEYXRhW2ldLnR5cGUudmFsdWUgPT0gZ2V0QXJlYVR5cGVCeUxhYmVsKCJDdXN0b20gQVBLIiwgdm0pKSB7CiAgICAgIGhvbWVwYWdlVGFibGVEYXRhW2ldLnZhbHVlLml0ZW1UeXBlID0gInNlbGVjdCI7CiAgICAgIGhvbWVwYWdlVGFibGVEYXRhW2ldLnZhbHVlLmRpc2FibGVkID0gZmFsc2U7CiAgICAgIGhvbWVwYWdlVGFibGVEYXRhW2ldLnZhbHVlLmlzV2FybiA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgaG9tZXBhZ2VUYWJsZURhdGFbaV0udmFsdWUuaXRlbVR5cGUgPSAiaW5wdXQiOwogICAgICBob21lcGFnZVRhYmxlRGF0YVtpXS52YWx1ZS5pc1dhcm4gPSBmYWxzZTsKICAgIH0gLy90eXBl5Y+Y5YyW5pe2bGFiZWzlgLzmm7TmlrDvvIx2YWx1ZeWAvOabtOaWsAoKCiAgICBpZiAoInVuZGVmaW5lZCIgIT0gdHlwZW9mIGV2ZW50ICYmIGV2ZW50Lml0ZW1LZXkgPT0gImhvbWVwYWdlIiAmJiBldmVudC5jb250ZW50S2V5ID09ICJob21lcGFnZSIpIHsKICAgICAgaWYgKGV2ZW50Lm5ld1ZhbFtpXS50eXBlLnZhbHVlICE9IGV2ZW50Lm9sZFZhbFtpXS50eXBlLnZhbHVlKSB7CiAgICAgICAgaWYgKHZtLmFwaURhdGEuY29uZmlnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMUFSRUEiICsgKGkgKyAxKSArICIuTEFCRUwiXSAhPSAiIiAmJiB2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTFBUkVBIiArIChpICsgMSkgKyAiLkRpc3BsYXlUeXBlIl0gPT0gZXZlbnQubmV3VmFsW2ldLnR5cGUudmFsdWUpIHsKICAgICAgICAgIHRhYmxlRGF0YVtpXS5sYWJlbC52YWx1ZSA9IHZtLmFwaURhdGEuY29uZmlnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMUFSRUEiICsgKGkgKyAxKSArICIuTEFCRUwiXTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaG9tZXBhZ2VUYWJsZURhdGFbaV0ubGFiZWwudmFsdWUgPSBnZXRPcHRpb25zQnlMYWJlbCh2bSwgZ2V0QXJlYVR5cGVCeUtleShob21lcGFnZVRhYmxlRGF0YVtpXS50eXBlLnZhbHVlLCB2bSkpOwogICAgICAgICAgdm0uY2hhbmdlZENmZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTFBUkVBIiArIChpICsgMSkgKyAiLkxBQkVMIl0gPSBob21lcGFnZVRhYmxlRGF0YVtpXS5sYWJlbC52YWx1ZTsKICAgICAgICB9CgogICAgICAgIGlmICh2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTFBUkVBIiArIChpICsgMSkgKyAiLkRpc3BsYXlUeXBlIl0gPT0gZXZlbnQubmV3VmFsW2ldLnR5cGUudmFsdWUpIHsKICAgICAgICAgIGhvbWVwYWdlVGFibGVEYXRhW2ldLnZhbHVlLnZhbHVlID0gdm0uYXBpRGF0YS5jb25maWdEYXRhWyJDb25maWcuSW5kb29yLlBBR0UxQVJFQSIgKyAoaSArIDEpICsgIi5WYWx1ZSJdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBob21lcGFnZVRhYmxlRGF0YVtpXS52YWx1ZS52YWx1ZSA9ICIiOwogICAgICAgICAgdm0uY2hhbmdlZENmZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTFBUkVBIiArIChpICsgMSkgKyAiLlZhbHVlIl0gPSAiIjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9IC8vbW9yZXBhZ2UKCgogIHZhciBtb3JlcGFnZUl0ZW0gPSBnZXRJdGVtQnlLZXkodm0uZGF0YSwgIm1vcmVwYWdlIiwgIm1vcmVwYWdlIik7CiAgdmFyIG1vcmVwYWdlVGFibGVEYXRhID0gbW9yZXBhZ2VJdGVtLnRhYmxlRGF0YTsKCiAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgbW9yZXBhZ2VUYWJsZURhdGEubGVuZ3RoOyBfaTIrKykgewogICAgLy90eXBl5piv5ZCm55u45ZCMCiAgICBtb3JlcGFnZVRhYmxlRGF0YVtfaTJdLnR5cGUuaXNXYXJuID0gZmFsc2U7CgogICAgZm9yICh2YXIgX2ogPSAwOyBfaiA8IG1vcmVwYWdlVGFibGVEYXRhLmxlbmd0aDsgX2orKykgewogICAgICBpZiAoX2kyICE9IF9qICYmIG1vcmVwYWdlVGFibGVEYXRhW19qXS50eXBlLnZhbHVlID09IG1vcmVwYWdlVGFibGVEYXRhW19pMl0udHlwZS52YWx1ZSAmJiBtb3JlcGFnZVRhYmxlRGF0YVtfal0udHlwZS52YWx1ZSAhPSBnZXRBcmVhVHlwZUJ5TGFiZWwoIkN1c3RvbSBBUEsiLCB2bSkgJiYgbW9yZXBhZ2VUYWJsZURhdGFbX2pdLnR5cGUudmFsdWUgIT0gZ2V0QXJlYVR5cGVCeUxhYmVsKCJCcm93c2VyIiwgdm0pICYmIG1vcmVwYWdlVGFibGVEYXRhW19qXS50eXBlLnZhbHVlICE9IGdldEFyZWFUeXBlQnlMYWJlbCgiTi9BIiwgdm0pKSB7CiAgICAgICAgbW9yZXBhZ2VUYWJsZURhdGFbX2kyXS50eXBlLmlzV2FybiA9IHRydWU7CiAgICAgICAgbW9yZXBhZ2VUYWJsZURhdGFbX2pdLnR5cGUuaXNXYXJuID0gdHJ1ZTsKICAgICAgfQogICAgfSAvL2ljb27mmL7npLrkuI7lkKYKCgogICAgaWYgKG1vcmVwYWdlVGFibGVEYXRhW19pMl0udHlwZS52YWx1ZSA9PSBnZXRBcmVhVHlwZUJ5TGFiZWwoIkRORCIsIHZtKSkgewogICAgICBtb3JlcGFnZVRhYmxlRGF0YVtfaTJdLmljb24uaXNTaG93ID0gZmFsc2U7CiAgICB9IGVsc2UgewogICAgICBtb3JlcGFnZVRhYmxlRGF0YVtfaTJdLmljb24uaXNTaG93ID0gdHJ1ZTsKICAgIH0gLy9sYWJlbOaYr+WQpuemgeeUqAoKCiAgICBpZiAobW9yZXBhZ2VUYWJsZURhdGFbX2kyXS50eXBlLnZhbHVlID09IGdldEFyZWFUeXBlQnlMYWJlbCgiRE5EIiwgdm0pIHx8IG1vcmVwYWdlVGFibGVEYXRhW19pMl0udHlwZS52YWx1ZSA9PSBnZXRBcmVhVHlwZUJ5TGFiZWwoIlVubG9jayIsIHZtKSkgewogICAgICBtb3JlcGFnZVRhYmxlRGF0YVtfaTJdLmxhYmVsLmRpc2FibGVkID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIG1vcmVwYWdlVGFibGVEYXRhW19pMl0ubGFiZWwuZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0gLy92YWx1ZeaYr+WQpuemgeeUqAoKCiAgICBpZiAobW9yZXBhZ2VUYWJsZURhdGFbX2kyXS50eXBlLnZhbHVlID09IGdldEFyZWFUeXBlQnlMYWJlbCgiQ3VzdG9tIEFQSyIsIHZtKSB8fCBtb3JlcGFnZVRhYmxlRGF0YVtfaTJdLnR5cGUudmFsdWUgPT0gZ2V0QXJlYVR5cGVCeUxhYmVsKCJCcm93c2VyIiwgdm0pKSB7CiAgICAgIG1vcmVwYWdlVGFibGVEYXRhW19pMl0udmFsdWUuZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0gZWxzZSB7CiAgICAgIG1vcmVwYWdlVGFibGVEYXRhW19pMl0udmFsdWUuZGlzYWJsZWQgPSB0cnVlOwogICAgfSAvL3ZhbHVl5YC855qEaW5wdXTlkoxzZWxlY3TmoYblj5jmjaIKCgogICAgaWYgKG1vcmVwYWdlVGFibGVEYXRhW19pMl0udHlwZS52YWx1ZSA9PSBnZXRBcmVhVHlwZUJ5TGFiZWwoIkN1c3RvbSBBUEsiLCB2bSkpIHsKICAgICAgbW9yZXBhZ2VUYWJsZURhdGFbX2kyXS52YWx1ZS5pdGVtVHlwZSA9ICJzZWxlY3QiOwogICAgICBtb3JlcGFnZVRhYmxlRGF0YVtfaTJdLnZhbHVlLmRpc2FibGVkID0gZmFsc2U7CiAgICAgIG1vcmVwYWdlVGFibGVEYXRhW19pMl0udmFsdWUuaXNXYXJuID0gZmFsc2U7CiAgICB9IGVsc2UgewogICAgICBtb3JlcGFnZVRhYmxlRGF0YVtfaTJdLnZhbHVlLml0ZW1UeXBlID0gImlucHV0IjsKICAgICAgbW9yZXBhZ2VUYWJsZURhdGFbX2kyXS52YWx1ZS5pc1dhcm4gPSBmYWxzZTsKICAgIH0gLy90eXBl5Y+Y5YyW5pe2bGFiZWzlgLzmm7TmlrDvvIx2YWx1ZeWAvOabtOaWsAoKCiAgICBpZiAoInVuZGVmaW5lZCIgIT0gdHlwZW9mIGV2ZW50ICYmIGV2ZW50Lml0ZW1LZXkgPT0gIm1vcmVwYWdlIiAmJiBldmVudC5jb250ZW50S2V5ID09ICJtb3JlcGFnZSIpIHsKICAgICAgaWYgKGV2ZW50Lm5ld1ZhbFtfaTJdLnR5cGUudmFsdWUgIT0gZXZlbnQub2xkVmFsW19pMl0udHlwZS52YWx1ZSkgewogICAgICAgIGlmICh2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTJBUkVBIiArIChfaTIgKyAxKSArICIuTEFCRUwiXSAhPSAiIiAmJiB2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTJBUkVBIiArIChfaTIgKyAxKSArICIuRGlzcGxheVR5cGUiXSA9PSBldmVudC5uZXdWYWxbX2kyXS50eXBlLnZhbHVlKSB7CiAgICAgICAgICBtb3JlcGFnZVRhYmxlRGF0YVtfaTJdLmxhYmVsLnZhbHVlID0gdm0uYXBpRGF0YS5jb25maWdEYXRhWyJDb25maWcuSW5kb29yLlBBR0UyQVJFQSIgKyAoX2kyICsgMSkgKyAiLkxBQkVMIl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1vcmVwYWdlVGFibGVEYXRhW19pMl0ubGFiZWwudmFsdWUgPSBnZXRPcHRpb25zQnlMYWJlbCh2bSwgZ2V0QXJlYVR5cGVCeUtleShtb3JlcGFnZVRhYmxlRGF0YVtfaTJdLnR5cGUudmFsdWUsIHZtKSk7CiAgICAgICAgICB2bS5jaGFuZ2VkQ2ZnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMkFSRUEiICsgKF9pMiArIDEpICsgIi5MQUJFTCJdID0gbW9yZXBhZ2VUYWJsZURhdGFbX2kyXS5sYWJlbC52YWx1ZTsKICAgICAgICB9CgogICAgICAgIGlmICh2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTJBUkVBIiArIChfaTIgKyAxKSArICIuRGlzcGxheVR5cGUiXSA9PSBldmVudC5uZXdWYWxbX2kyXS50eXBlLnZhbHVlKSB7CiAgICAgICAgICBtb3JlcGFnZVRhYmxlRGF0YVtfaTJdLnZhbHVlLnZhbHVlID0gdm0uYXBpRGF0YS5jb25maWdEYXRhWyJDb25maWcuSW5kb29yLlBBR0UyQVJFQSIgKyAoX2kyICsgMSkgKyAiLlZhbHVlIl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1vcmVwYWdlVGFibGVEYXRhW19pMl0udmFsdWUudmFsdWUgPSAiIjsKICAgICAgICAgIHZtLmNoYW5nZWRDZmdEYXRhWyJDb25maWcuSW5kb29yLlBBR0UyQVJFQSIgKyAoX2kyICsgMSkgKyAiLlZhbHVlIl0gPSAiIjsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9IC8vd2FsbCBwYXBhZXIKCgogIHZhciB3YWxsUGFwZXJGaWxlSXRlbSA9IGdldEl0ZW1CeUtleSh2bS5kYXRhLCAid2FsbHBhcGVyIiwgIkNvbmZpZy5TZXR0aW5ncy5MT0dPLldhbGxwYXBlciIpOwogIHdhbGxQYXBlckZpbGVJdGVtLmRlbERpc2FibGVkID0gZmFsc2U7CiAgdmFyIHdhbGxwYXBlckRlZmF1bHRQaWN0dXJlID0gdm0uYXBpRGF0YS5kYXRhLndhbGxwYXBlckRlZmF1bHRGaWxlcy5zcGxpdCgiXG4iKTsKCiAgZm9yICh2YXIgX2kzID0gMDsgX2kzIDwgd2FsbHBhcGVyRGVmYXVsdFBpY3R1cmUubGVuZ3RoOyBfaTMrKykgewogICAgdmFyIHdhbGxwYXBlclBpY3R1cmUgPSB2bS5hcGlEYXRhLmRhdGEud2FsbHBhcGVyUGF0aCArICJkZWZhdWx0LyIgKyB3YWxscGFwZXJEZWZhdWx0UGljdHVyZVtfaTNdOwoKICAgIGlmICh3YWxsUGFwZXJGaWxlSXRlbS52YWx1ZSA9PSB3YWxscGFwZXJQaWN0dXJlKSB7CiAgICAgIHdhbGxQYXBlckZpbGVJdGVtLmRlbERpc2FibGVkID0gdHJ1ZTsKICAgICAgYnJlYWs7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBnZXRBcmVhVHlwZUJ5TGFiZWwobGFiZWwsIHZtKSB7CiAgdmFyIHR5cGVzID0gdm0uYXBpRGF0YS5kYXRhLlBhZ2UxRGlzcGxheVR5cGVzOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IHR5cGVzLmxlbmd0aDsgaSsrKSB7CiAgICBpZiAodHlwZXNbaV0ubGFiZWwgPT0gbGFiZWwpIHsKICAgICAgcmV0dXJuIHR5cGVzW2ldLmtleTsKICAgIH0KICB9CgogIHJldHVybiAtMTsKfQoKZnVuY3Rpb24gZ2V0QXJlYVR5cGVCeUtleShrZXksIHZtKSB7CiAgdmFyIHR5cGVzID0gdm0uYXBpRGF0YS5kYXRhLlBhZ2UxRGlzcGxheVR5cGVzOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IHR5cGVzLmxlbmd0aDsgaSsrKSB7CiAgICBpZiAodHlwZXNbaV0ua2V5ID09IGtleSkgewogICAgICByZXR1cm4gdHlwZXNbaV0ubGFiZWw7CiAgICB9CiAgfQoKICByZXR1cm4gLTE7Cn0KCmZ1bmN0aW9uIHN1Ym1pdERhdGEodm0pIHsKICB2bS5kYXRhLnN1Ym1pdExvYWRpbmcgPSB0cnVlOwogIHZhciByZXF1ZXN0RGF0YSA9IHsKICAgIHRhcmdldDogInBob25lRGlzcGxheVNldHRpbmciLAogICAgYWN0aW9uOiAic2V0IiwKICAgIGNvbmZpZ0RhdGE6IHZtLnN1Ym1pdENmZ0RhdGEKICB9OwogIHZtLiRheGlvcy5wb3N0KCJhcGkiLCByZXF1ZXN0RGF0YSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgIGlmICgidW5kZWZpbmVkIiAhPSB0eXBlb2YgcmVzcG9uc2UpIHsKICAgICAgc2hvd1JlcXVlc3RTdWNjZXNzKHZtKTsKICAgIH0KCiAgICB2bS5kYXRhLnN1Ym1pdExvYWRpbmcgPSBmYWxzZTsKICB9KTsKfQoKZnVuY3Rpb24gZ2V0RGF0YSh2bSkgewogIHZtLiRheGlvcy5nZXQoImFwaS9waG9uZURpc3BsYXlTZXR0aW5nL2luZm8iKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgdm0uZ2V0RGF0YVN1Y2Nlc3MgPSB0cnVlOwogICAgdm0uYXBpRGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICB2bS5jaGFuZ2VkQ2ZnRGF0YSA9IGRlZXBDbG9uZShyZXNwb25zZS5kYXRhLmNvbmZpZ0RhdGEpOwogICAgY3JlYXRlUGFnZURhdGEodm0pOwogICAgaGFuZGxlclBhZ2VDaGFuZ2VkKHZtKTsKICB9KTsKfQoKZnVuY3Rpb24gZ2V0Q29tbWl0RGF0YSh2bSkgewogIHZtLnN1Ym1pdENmZ0RhdGEgPSB7fTsKCiAgZm9yICh2YXIgY2hhbmdlZEtleSBpbiB2bS5jaGFuZ2VkQ2ZnRGF0YSkgewogICAgaWYgKHZtLmFwaURhdGEuY29uZmlnRGF0YVtjaGFuZ2VkS2V5XSAhPSB2bS5jaGFuZ2VkQ2ZnRGF0YVtjaGFuZ2VkS2V5XSB8fCBjaGFuZ2VkS2V5ID09ICJDb25maWcuU2V0dGluZ3MuTE9HTy5XYWxscGFwZXIiKSB7CiAgICAgIHZtLnN1Ym1pdENmZ0RhdGFbY2hhbmdlZEtleV0gPSB2bS5jaGFuZ2VkQ2ZnRGF0YVtjaGFuZ2VkS2V5XTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGNoZWNrQ29tbWl0RGF0YSh2bSkgewogIHJldHVybiBjaGVja0hvbWVwYWdlRGF0YSh2bSkgJiYgY2hlY2tNb3JlcGFnZURhdGEodm0pOwp9CgpmdW5jdGlvbiBjaGVja01vcmVwYWdlRGF0YSh2bSkgewogIHZhciBzdWNjZXNzID0gdHJ1ZTsKICB2YXIgaXRlbSA9IGdldEl0ZW1CeUtleSh2bS5kYXRhLCAibW9yZXBhZ2UiLCAibW9yZXBhZ2UiKTsKICB2YXIgdGFibGVEYXRhID0gaXRlbS50YWJsZURhdGE7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgdGFibGVEYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAvL3R5cGXmmK/lkKbnm7jlkIwKICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGFibGVEYXRhLmxlbmd0aDsgaisrKSB7CiAgICAgIGlmIChpICE9IGogJiYgdGFibGVEYXRhW2pdLnR5cGUudmFsdWUgPT0gdGFibGVEYXRhW2ldLnR5cGUudmFsdWUgJiYgdGFibGVEYXRhW2pdLnR5cGUudmFsdWUgIT0gZ2V0QXJlYVR5cGVCeUxhYmVsKCJDdXN0b20gQVBLIiwgdm0pICYmIHRhYmxlRGF0YVtqXS50eXBlLnZhbHVlICE9IGdldEFyZWFUeXBlQnlMYWJlbCgiQnJvd3NlciIsIHZtKSAmJiB0YWJsZURhdGFbal0udHlwZS52YWx1ZSAhPSBnZXRBcmVhVHlwZUJ5TGFiZWwoIk4vQSIsIHZtKSkgewogICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIGlmICh0YWJsZURhdGFbaV0udHlwZS52YWx1ZSA9PSBnZXRBcmVhVHlwZUJ5TGFiZWwoIkN1c3RvbSBBUEsiLCB2bSkgfHwgdGFibGVEYXRhW2ldLnR5cGUudmFsdWUgPT0gZ2V0QXJlYVR5cGVCeUxhYmVsKCJCcm93c2VyIiwgdm0pKSB7CiAgICAgIGlmICh0YWJsZURhdGFbaV0udmFsdWUudmFsdWUgPT0gIiIpIHsKICAgICAgICB0YWJsZURhdGFbaV0udmFsdWUuaXNXYXJuID0gdHJ1ZTsKICAgICAgICBzdWNjZXNzID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBzdWNjZXNzOwp9CgpmdW5jdGlvbiBjaGVja0hvbWVwYWdlRGF0YSh2bSkgewogIHZhciBzdWNjZXNzID0gdHJ1ZTsKICB2YXIgaXRlbSA9IGdldEl0ZW1CeUtleSh2bS5kYXRhLCAiaG9tZXBhZ2UiLCAiaG9tZXBhZ2UiKTsKICB2YXIgdGFibGVEYXRhID0gaXRlbS50YWJsZURhdGE7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgdGFibGVEYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAvL3R5cGXmmK/lkKbnm7jlkIwKICAgIGZvciAodmFyIGogPSAwOyBqIDwgdGFibGVEYXRhLmxlbmd0aDsgaisrKSB7CiAgICAgIGlmIChpICE9IGogJiYgdGFibGVEYXRhW2pdLnR5cGUudmFsdWUgPT0gdGFibGVEYXRhW2ldLnR5cGUudmFsdWUgJiYgdGFibGVEYXRhW2pdLnR5cGUudmFsdWUgIT0gZ2V0QXJlYVR5cGVCeUxhYmVsKCJDdXN0b20gQVBLIiwgdm0pICYmIHRhYmxlRGF0YVtqXS50eXBlLnZhbHVlICE9IGdldEFyZWFUeXBlQnlMYWJlbCgiQnJvd3NlciIsIHZtKSAmJiB0YWJsZURhdGFbal0udHlwZS52YWx1ZSAhPSBnZXRBcmVhVHlwZUJ5TGFiZWwoIk4vQSIsIHZtKSkgewogICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgfQogICAgfQoKICAgIGlmICh0YWJsZURhdGFbaV0udHlwZS52YWx1ZSA9PSBnZXRBcmVhVHlwZUJ5TGFiZWwoIkN1c3RvbSBBUEsiLCB2bSkgfHwgdGFibGVEYXRhW2ldLnR5cGUudmFsdWUgPT0gZ2V0QXJlYVR5cGVCeUxhYmVsKCJCcm93c2VyIiwgdm0pKSB7CiAgICAgIGlmICh0YWJsZURhdGFbaV0udmFsdWUudmFsdWUgPT0gIiIpIHsKICAgICAgICB0YWJsZURhdGFbaV0udmFsdWUuaXNXYXJuID0gdHJ1ZTsKICAgICAgICBzdWNjZXNzID0gZmFsc2U7CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBzdWNjZXNzOwp9CgpmdW5jdGlvbiBjcmVhdGVTZWxlY3RJdGVtcyh2bSkgewogIC8vYXBrbGlzdAogIHZtLmFwcFNlbGVjdEl0ZW1zID0gW107CiAgdmFyIGFwcEl0ZW1zID0gdm0uYXBpRGF0YS5kYXRhLmFwa0xpc3Quc3BsaXQoIiYiKTsKCiAgaWYgKHZtLmFwaURhdGEuZGF0YS5hcGtMaXN0ID09ICJudWxsIikgewogICAgdm0uYXBwU2VsZWN0SXRlbXMucHVzaCh7CiAgICAgIGtleTogIiIsCiAgICAgIGxhYmVsOiAiIgogICAgfSk7CiAgfSBlbHNlIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXBwSXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGFwcEl0ZW1zW2ldLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIHZhciBhcnIgPSBhcHBJdGVtc1tpXS5zcGxpdCgiPSIpOwogICAgICB2YXIgc2VsZWN0SXRlbSA9IHsKICAgICAgICBrZXk6IGFyclsxXSwKICAgICAgICBsYWJlbDogYXJyWzBdCiAgICAgIH07CiAgICAgIHZtLmFwcFNlbGVjdEl0ZW1zLnB1c2goc2VsZWN0SXRlbSk7CiAgICB9CiAgfSAvL3BhZ2UxIHR5cGUgc2VsZWN0IGl0ZW1zCgoKICB2bS50eXBlSXRlbXMgPSBbXTsKICB2YXIgdHlwZXMgPSB2bS5hcGlEYXRhLmRhdGEuUGFnZTFEaXNwbGF5VHlwZXM7CgogIGZvciAodmFyIF9pNCA9IDA7IF9pNCA8IHR5cGVzLmxlbmd0aCAtIDE7IF9pNCsrKSB7CiAgICB2YXIgaXRlbSA9IHsKICAgICAga2V5OiB0eXBlc1tfaTRdLmtleSwKICAgICAgbGFiZWw6IGdldE9wdGlvbnNCeUxhYmVsKHZtLCB0eXBlc1tfaTRdLmxhYmVsKQogICAgfTsKICAgIHZtLnR5cGVJdGVtcy5wdXNoKGl0ZW0pOwogIH0gLy9wYWdlMiB0eXBlIHNlbGVjdCBpdGVtcwoKCiAgdm0udHlwZTJJdGVtcyA9IFtdOwogIHZhciB0eXBlczIgPSB2bS5hcGlEYXRhLmRhdGEuUGFnZTFEaXNwbGF5VHlwZXM7CgogIGZvciAodmFyIF9pNSA9IDA7IF9pNSA8IHR5cGVzMi5sZW5ndGg7IF9pNSsrKSB7CiAgICB2YXIgX2l0ZW0gPSB7CiAgICAgIGtleTogdHlwZXNbX2k1XS5rZXksCiAgICAgIGxhYmVsOiBnZXRPcHRpb25zQnlMYWJlbCh2bSwgdHlwZXNbX2k1XS5sYWJlbCkKICAgIH07CiAgICB2bS50eXBlMkl0ZW1zLnB1c2goX2l0ZW0pOwogIH0gLy9zY3JlZW4gcGljdHVyZQoKCiAgdm0uc2NyZWVuU2F2ZXJWaWRlb0l0ZW1zID0gW107CiAgdm0uc2NyZWVuU2F2ZXJQaWN0dXJlSXRlbXMgPSBbXTsKICB2YXIgc2NyZWVuU2F2ZXIgPSB2bS5hcGlEYXRhLmRhdGEuc2NyZWVuU2F2ZXJGaWxlcy5zcGxpdCgiXG4iKTsKCiAgZm9yICh2YXIgX2k2ID0gMDsgX2k2IDwgc2NyZWVuU2F2ZXIubGVuZ3RoOyBfaTYrKykgewogICAgaWYgKHNjcmVlblNhdmVyW19pNl0gIT0gIiIpIHsKICAgICAgdmFyIF9pdGVtMiA9IHsKICAgICAgICBrZXk6IHNjcmVlblNhdmVyW19pNl0sCiAgICAgICAgbGFiZWw6IHNjcmVlblNhdmVyW19pNl0KICAgICAgfTsKCiAgICAgIGlmIChjaGVja0ZpbGVGb3JtYXQoc2NyZWVuU2F2ZXJbX2k2XSwgIi5KUEciLCA0KSB8fCBjaGVja0ZpbGVGb3JtYXQoc2NyZWVuU2F2ZXJbX2k2XSwgIi5KUEVHIiwgNSkgfHwgY2hlY2tGaWxlRm9ybWF0KHNjcmVlblNhdmVyW19pNl0sICIuUE5HIiwgNCkpIHsKICAgICAgICB2bS5zY3JlZW5TYXZlclBpY3R1cmVJdGVtcy5wdXNoKF9pdGVtMik7CiAgICAgIH0gZWxzZSBpZiAoY2hlY2tGaWxlRm9ybWF0KHNjcmVlblNhdmVyW19pNl0sICIuTVA0IiwgNCkgfHwgY2hlY2tGaWxlRm9ybWF0KHNjcmVlblNhdmVyW19pNl0sICIuV01WIiwgNCkgfHwgY2hlY2tGaWxlRm9ybWF0KHNjcmVlblNhdmVyW19pNl0sICIuQVZJIiwgNCkpIHsKICAgICAgICB2bS5zY3JlZW5TYXZlclZpZGVvSXRlbXMucHVzaChfaXRlbTIpOwogICAgICB9CiAgICB9CiAgfSAvL3NjcmVlbiBzYXZlciB0eXBlcwoKCiAgdm0uc2NyZWVuU2F2ZXJUeXBlSXRlbXMgPSBbXTsKCiAgaWYgKHZtLmFwaURhdGEuY29uZmlnRGF0YVsiQ29uZmlnLkRvb3JTZXR0aW5nLkNPTk5FQ1QuU2VydmVyTW9kZSJdID09IDEpIHsKICAgIHZtLnNjcmVlblNhdmVyVHlwZUl0ZW1zLnB1c2goewogICAgICBrZXk6IDAsCiAgICAgIGxhYmVsOiB2bS4kdCgiU0RNQyIpCiAgICB9KTsKICAgIHZtLnNjcmVlblNhdmVyVHlwZUl0ZW1zLnB1c2goewogICAgICBrZXk6IDIsCiAgICAgIGxhYmVsOiB2bS4kdCgiU0RNQ0xvY2FsUGljdHVyZXMiKQogICAgfSk7CiAgfQoKICB2bS5zY3JlZW5TYXZlclR5cGVJdGVtcy5wdXNoKHsKICAgIGtleTogMSwKICAgIGxhYmVsOiB2bS4kdCgiTG9jYWxQaWN0dXJlcyIpCiAgfSk7CiAgdm0uc2NyZWVuU2F2ZXJUeXBlSXRlbXMucHVzaCh7CiAgICBrZXk6IDYsCiAgICBsYWJlbDogdm0uJHQoIkNsb2NrIikKICB9KTsKCiAgaWYgKHZtLmFwaURhdGEuZGF0YS5oYXNBa0ZhY2UgIT0gIiIpIHsKICAgIGlmICh2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5Eb29yU2V0dGluZy5DT05ORUNULlNlcnZlck1vZGUiXSA9PSAxKSB7CiAgICAgIHZtLnNjcmVlblNhdmVyVHlwZUl0ZW1zLnB1c2goewogICAgICAgIGtleTogMywKICAgICAgICBsYWJlbDogdm0uJHQoIlNETUNWaWRlb3MiKQogICAgICB9KTsKICAgICAgdm0uc2NyZWVuU2F2ZXJUeXBlSXRlbXMucHVzaCh7CiAgICAgICAga2V5OiA1LAogICAgICAgIGxhYmVsOiB2bS4kdCgiU0RNQ0xvY2FsVmlkZW9zIikKICAgICAgfSk7CiAgICB9CgogICAgdm0uc2NyZWVuU2F2ZXJUeXBlSXRlbXMucHVzaCh7CiAgICAgIGtleTogNCwKICAgICAgbGFiZWw6IHZtLiR0KCJMb2NhbFZpZGVvcyIpCiAgICB9KTsKICB9IC8vd2FsbHBhcGVyIGZpbGVzCgoKICB2bS53YWxscGFwZXJGaWxlSXRlbXNDYWxsID0gW107CiAgdm0ud2FsbHBhcGVyRmlsZUl0ZW1zID0gW107CiAgdmFyIHdhbGxwZXBlckRlZmF1bHRGaWxlcyA9IHZtLmFwaURhdGEuZGF0YS53YWxscGFwZXJEZWZhdWx0RmlsZXMuc3BsaXQoIlxuIik7CgogIGZvciAodmFyIF9pNyA9IDA7IF9pNyA8IHdhbGxwZXBlckRlZmF1bHRGaWxlcy5sZW5ndGg7IF9pNysrKSB7CiAgICB2YXIgX2l0ZW0zID0gewogICAgICBrZXk6IHZtLmFwaURhdGEuZGF0YS53YWxscGFwZXJQYXRoICsgImRlZmF1bHQvIiArIHdhbGxwZXBlckRlZmF1bHRGaWxlc1tfaTddLAogICAgICBsYWJlbDogd2FsbHBlcGVyRGVmYXVsdEZpbGVzW19pN10KICAgIH07CgogICAgaWYgKHdhbGxwZXBlckRlZmF1bHRGaWxlc1tfaTddICE9ICIiKSB7CiAgICAgIHZtLndhbGxwYXBlckZpbGVJdGVtcy5wdXNoKF9pdGVtMyk7CgogICAgICBpZiAoISh3YWxscGVwZXJEZWZhdWx0RmlsZXNbX2k3XSA9PSAiMS5qcGciIHx8IHdhbGxwZXBlckRlZmF1bHRGaWxlc1tfaTddID09ICI0LmpwZyIpKSB7CiAgICAgICAgdm0ud2FsbHBhcGVyRmlsZUl0ZW1zQ2FsbC5wdXNoKF9pdGVtMyk7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciB3YWxscGVwZXJGaWxlcyA9IHZtLmFwaURhdGEuZGF0YS53YWxscGFwZXJGaWxlcy5zcGxpdCgiXG4iKTsKCiAgZm9yICh2YXIgX2k4ID0gMDsgX2k4IDwgd2FsbHBlcGVyRmlsZXMubGVuZ3RoOyBfaTgrKykgewogICAgaWYgKHdhbGxwZXBlckZpbGVzW19pOF0gIT0gIiIgJiYgKGNoZWNrRmlsZUZvcm1hdCh3YWxscGVwZXJGaWxlc1tfaThdLCAiLlBORyIsIDQpIHx8IGNoZWNrRmlsZUZvcm1hdCh3YWxscGVwZXJGaWxlc1tfaThdLCAiLkpQRyIsIDQpIHx8IGNoZWNrRmlsZUZvcm1hdCh3YWxscGVwZXJGaWxlc1tfaThdLCAiLkpQRUciLCA1KSkpIHsKICAgICAgdmFyIF9pdGVtNCA9IHsKICAgICAgICBrZXk6IHZtLmFwaURhdGEuZGF0YS53YWxscGFwZXJQYXRoICsgd2FsbHBlcGVyRmlsZXNbX2k4XSwKICAgICAgICBsYWJlbDogd2FsbHBlcGVyRmlsZXNbX2k4XQogICAgICB9OwogICAgICB2bS53YWxscGFwZXJGaWxlSXRlbXMucHVzaChfaXRlbTQpOwogICAgICB2bS53YWxscGFwZXJGaWxlSXRlbXNDYWxsLnB1c2goX2l0ZW00KTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGNyZWF0ZVBhZ2VEYXRhKHZtKSB7CiAgdm0uZGF0YSA9IHsKICAgIGdldERhdGFTdWNjZXNzOiB0cnVlLAogICAgYnJlYWRDcnVtYjogewogICAgICBmaXJzdFRpdGxlOiB2bS4kdCgiUGhvbmUiKSwKICAgICAgc2Vjb25kVGl0bGU6IHZtLiR0KCJEaXNwbGF5U2V0dGluZyIpCiAgICB9LAogICAgb25TdWJtaXQ6IGZ1bmN0aW9uIG9uU3VibWl0KCkgewogICAgICBpZiAoIWNoZWNrQ29tbWl0RGF0YSh2bSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGdldENvbW1pdERhdGEodm0pOwogICAgICBzdWJtaXREYXRhKHZtKTsKICAgIH0sCiAgICBvbkNhbmNlbDogZnVuY3Rpb24gb25DYW5jZWwoKSB7CiAgICAgIHZtLmRhdGEuY2FuY2VsTG9hZGluZyA9IHRydWU7CiAgICAgIGdldERhdGEodm0pOwogICAgfSwKICAgIHN1Ym1pdExvYWRpbmc6IGZhbHNlLAogICAgY2FuY2VsTG9hZGluZzogZmFsc2UsCiAgICBjb250ZW50czogW10KICB9OwogIGNyZWF0ZVNlbGVjdEl0ZW1zKHZtKTsKICB2bS5kYXRhLmNvbnRlbnRzLnB1c2goY3JlYXRlVGhlbWVDb250ZW50KHZtKSk7CiAgdm0uZGF0YS5jb250ZW50cy5wdXNoKGNyZWF0ZUhvbWVwYWdlQ29udGVudCh2bSkpOwogIHZtLmRhdGEuY29udGVudHMucHVzaChjcmVhdGVNb3JlcGFnZUNvbnRlbnQodm0pKTsKICB2bS5kYXRhLmNvbnRlbnRzLnB1c2goY3JlYXRlU2NyZWVuU2F2ZXJDb250ZW50KHZtKSk7CiAgdm0uZGF0YS5jb250ZW50cy5wdXNoKGNyZWF0ZVdhbGxwYXBhZXJDb250ZW50KHZtKSk7CiAgdm0uZGF0YS5jb250ZW50cy5wdXNoKGNyZWF0ZUJvb3RMb2dvQ29udGVudCh2bSkpOwp9CgpmdW5jdGlvbiBjcmVhdGVUaGVtZUNvbnRlbnQodm0pIHsKICB2YXIgY29udGVudCA9IHsKICAgIGtleTogInRoZW1lU2V0dGluZyIsCiAgICB0aXRsZTogdm0uJHQoIlRoZW1lTGFiZWwiKSwKICAgIHRpdGxlRGVzY3JpcHRpb246IHZtLiR0KCJUaGVtZVNldHRpbmdEZXNjIiksCiAgICBpdGVtczogW3sKICAgICAgdGl0bGU6IHZtLiR0KCJUaGVtZUxhYmVsIiksCiAgICAgIHR5cGU6ICJzZWxlY3QiLAogICAgICBrZXk6ICJDb25maWcuU2V0dGluZ3MuRElTUExBWVNUWUxFLklkbGVTdHlsZSIsCiAgICAgIHZhbHVlOiB2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5TZXR0aW5ncy5ESVNQTEFZU1RZTEUuSWRsZVN0eWxlIl0gPT0gIiIgPyA0IDogdm0uYXBpRGF0YS5jb25maWdEYXRhWyJDb25maWcuU2V0dGluZ3MuRElTUExBWVNUWUxFLklkbGVTdHlsZSJdLAogICAgICBzZWxlY3RJdGVtczogW3sKICAgICAgICBrZXk6IDQsCiAgICAgICAgbGFiZWw6ICJEZWZhdWx0IgogICAgICB9LCB7CiAgICAgICAga2V5OiA1LAogICAgICAgIGxhYmVsOiAiQ2FsbCBMaXN0IgogICAgICB9XSwKICAgICAgZGVzY3JpcHRpb246IHZtLiR0KCJUaGVtZVNldHRpbmdEZXNjIikKICAgIH1dCiAgfTsKICByZXR1cm4gY29udGVudDsKfQoKZnVuY3Rpb24gY3JlYXRlQm9vdExvZ29Db250ZW50KHZtKSB7CiAgdmFyIGNvbnRlbnQgPSB7CiAgICBrZXk6ICJib290TG9nbyIsCiAgICB0aXRsZTogdm0uJHQoIkJvb3RMb2dvIiksCiAgICB0aXRsZURlc2NyaXB0aW9uOiB2bS4kdCgiQm9vdExvZ29EZXNjIiksCiAgICBpdGVtczogW3sKICAgICAgdGl0bGU6IHZtLiR0KCJCb290TG9nbyIpLAogICAgICB0eXBlOiAiZmlsZS1pbnB1dCIsCiAgICAgIGtleTogImJvb3RMb2dvVXBsb2FkIiwKICAgICAgYWNjZXB0RmlsZVR5cGU6ICIuemlwLC5wbmciLAogICAgICBtb2RhbFRpdGxlOiB2bS4kdCgiQm9vdExvZ29Gb3JtYXQxMjgwIiksCiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICB2YWx1ZTogewogICAgICAgIGZpbGVEYXRhOiB7fSwKICAgICAgICBmaWxlTmFtZTogdm0uJHQoIlVwZ3JhZGVGaWxlUGF0aCIpCiAgICAgIH0sCiAgICAgIGltcG9ydEJ0bk5hbWU6IHZtLiR0KCJJbXBvcnQiKSwKICAgICAgbW9kYWxDb25maXJtTmFtZTogdm0uJHQoIlVwbG9hZCIpLAogICAgICBpbWdSZXNvbHV0aW9uV2lkdGg6IDEyODAsCiAgICAgIGltZ1Jlc29sdXRpb25IZWlnaHQ6IDgwMCwKICAgICAgdXBsb2FkRnVuY3Rpb246IGZ1bmN0aW9uIHVwbG9hZEZ1bmN0aW9uKCkgewogICAgICAgIHVwbG9hZEZpbGUodm0sICJib290TG9nbyIsICJib290TG9nb1VwbG9hZCIpOwogICAgICB9LAogICAgICBpc1Nob3dFeHBvcnQ6IHRydWUsCiAgICAgIGV4cG9ydEJ0bk5hbWU6IHZtLiR0KCJSZXNldCIpLAogICAgICBleHBvcnRCdG5JY29uOiAiaWNvbnJlc2V0IiwKICAgICAgb25FeHBvcnQ6IGZ1bmN0aW9uIG9uRXhwb3J0KCkgewogICAgICAgIG9uRGVsRmlsZSh2bSwgIiIsICJib290TG9nbyIsICJib290TG9nb1VwbG9hZCIpOwogICAgICB9LAogICAgICBkZXNjcmlwdGlvbjogdm0uJHQoIkJvb3RMb2dvRGVzYyIpCiAgICB9XQogIH07CiAgcmV0dXJuIGNvbnRlbnQ7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVdhbGxwYXBhZXJDb250ZW50KHZtKSB7CiAgdmFyIGNvbnRlbnQgPSB7CiAgICBrZXk6ICJ3YWxscGFwZXIiLAogICAgdGl0bGU6IHZtLiR0KCJXYWxscGFwZXIiKSwKICAgIHRpdGxlRGVzY3JpcHRpb246IHZtLiR0KCJXYWxscGFwZXJEZXNjIiksCiAgICBpdGVtczogW3sKICAgICAgdGl0bGU6IHZtLiR0KCJXYWxscGFwZXIiKSwKICAgICAgdHlwZTogImZpbGUtaW5wdXQiLAogICAgICBrZXk6ICJ3YWxscGFwZXJVcGxvYWQiLAogICAgICBhY2NlcHRGaWxlVHlwZTogIi5qcGcsLmpwZWcsLnBuZyIsCiAgICAgIG1vZGFsVGl0bGU6IHZtLiR0KCJXYWxscGFwZXJGb3JtYXQxMjgwIiksCiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICB2YWx1ZTogewogICAgICAgIGZpbGVEYXRhOiB7fSwKICAgICAgICBmaWxlTmFtZTogdm0uJHQoIlVwZ3JhZGVGaWxlUGF0aCIpCiAgICAgIH0sCiAgICAgIGltcG9ydEJ0bk5hbWU6IHZtLiR0KCJJbXBvcnQiKSwKICAgICAgbW9kYWxDb25maXJtTmFtZTogdm0uJHQoIlVwbG9hZCIpLAogICAgICBpbWdSZXNvbHV0aW9uV2lkdGg6IDEyODAsCiAgICAgIGltZ1Jlc29sdXRpb25IZWlnaHQ6IDgwMCwKICAgICAgdXBsb2FkRnVuY3Rpb246IGZ1bmN0aW9uIHVwbG9hZEZ1bmN0aW9uKCkgewogICAgICAgIHVwbG9hZEZpbGUodm0sICJ3YWxscGFwZXIiLCAid2FsbHBhcGVyVXBsb2FkIik7CiAgICAgIH0sCiAgICAgIGRlc2NyaXB0aW9uOiB2bS4kdCgiV2FsbHBhcGVyRGVzYyIpCiAgICB9LCB7CiAgICAgIHRpdGxlOiB2bS4kdCgiV2FsbHBhcGVyRmlsZXMiKSwKICAgICAgdHlwZTogInNlbGVjdCIsCiAgICAgIGtleTogIkNvbmZpZy5TZXR0aW5ncy5MT0dPLldhbGxwYXBlciIsCiAgICAgIHZhbHVlOiB2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5TZXR0aW5ncy5MT0dPLldhbGxwYXBlciJdLAogICAgICBzZWxlY3RJdGVtczogdm0ud2FsbHBhcGVyRmlsZUl0ZW1zLAogICAgICBzaG93QnRuOiB0cnVlLAogICAgICBvbkRlbDogZnVuY3Rpb24gb25EZWwodmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgIT0gIiIpIHsKICAgICAgICAgIG9uRGVsRmlsZSh2bSwgdmFsdWUsICJ3YWxscGFwZXIiLCAid2FsbHBhcGVyRGVsIik7CiAgICAgICAgfQogICAgICB9LAogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgZGVsRGlzYWJsZWQ6IGZhbHNlLAogICAgICBkZXNjcmlwdGlvbjogdm0uJHQoIldhbGxwYXBlckZpbGVEZXNjIikKICAgIH1dCiAgfTsKICByZXR1cm4gY29udGVudDsKfQoKZnVuY3Rpb24gY3JlYXRlU2NyZWVuU2F2ZXJDb250ZW50KHZtKSB7CiAgdmFyIGNvbnRlbnQgPSB7CiAgICBrZXk6ICJzY3JlZW5TYXZlciIsCiAgICB0aXRsZTogdm0uJHQoIlNjcmVlblNhdmVyU2V0dGluZyIpLAogICAgdGl0bGVEZXNjcmlwdGlvbjogdm0uJHQoIlNjcmVlblNldHRpbmdEZXNjIiksCiAgICBpdGVtczogW3sKICAgICAgdGl0bGU6IHZtLiR0KCJTY3JlZW5TYXZlclBpY3R1cmVzIiksCiAgICAgIHR5cGU6ICJmaWxlLWlucHV0IiwKICAgICAga2V5OiAic2NyZWVuU2F2ZXJQaWN0dXJlIiwKICAgICAgYWNjZXB0RmlsZVR5cGU6ICIuanBnLC5wbmcsLmpwZWciLAogICAgICBtb2RhbFRpdGxlOiB2bS4kdCgiU2NyZWVuU2F2ZXJGb3JtYXQiKSwKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIHZhbHVlOiB7CiAgICAgICAgZmlsZURhdGE6IHt9LAogICAgICAgIGZpbGVOYW1lOiB2bS4kdCgiVXBncmFkZUZpbGVQYXRoIikKICAgICAgfSwKICAgICAgaW1wb3J0QnRuTmFtZTogdm0uJHQoIkltcG9ydCIpLAogICAgICBtb2RhbENvbmZpcm1OYW1lOiB2bS4kdCgiVXBsb2FkIiksCiAgICAgIHVwbG9hZEZ1bmN0aW9uOiBmdW5jdGlvbiB1cGxvYWRGdW5jdGlvbigpIHsKICAgICAgICB1cGxvYWRGaWxlKHZtLCAic2NyZWVuU2F2ZXIiLCAic2NyZWVuU2F2ZXJQaWN0dXJlIik7CiAgICAgIH0sCiAgICAgIG1heFNpemU6IDIgKiAxMDI0ICogMTAyNCwKICAgICAgZGVzY3JpcHRpb246IHZtLiR0KCJTY3JlZW5QaWN0dXJlRGVzYyIpCiAgICB9LCB7CiAgICAgIHRpdGxlOiB2bS4kdCgiU2NyZWVuU2F2ZXJWaWRlb3MiKSwKICAgICAgaXNIaWRlOiB2bS5hcGlEYXRhLmRhdGEuaGFzQWtGYWNlID09ICIiLAogICAgICB0eXBlOiAiZmlsZS1pbnB1dCIsCiAgICAgIGtleTogInNjcmVlblNhdmVyVmlkZW8iLAogICAgICBhY2NlcHRGaWxlVHlwZTogIi5tcDQsLndtdiwuYXZpIiwKICAgICAgbW9kYWxUaXRsZTogdm0uJHQoIlNjcmVlblNhdmVyVmlkZW9Gb3JtYXQiKSwKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIHZhbHVlOiB7CiAgICAgICAgZmlsZURhdGE6IHt9LAogICAgICAgIGZpbGVOYW1lOiB2bS4kdCgiVXBncmFkZUZpbGVQYXRoIikKICAgICAgfSwKICAgICAgaW1wb3J0QnRuTmFtZTogdm0uJHQoIkltcG9ydCIpLAogICAgICBtb2RhbENvbmZpcm1OYW1lOiB2bS4kdCgiVXBsb2FkIiksCiAgICAgIHVwbG9hZEZ1bmN0aW9uOiBmdW5jdGlvbiB1cGxvYWRGdW5jdGlvbigpIHsKICAgICAgICB1cGxvYWRGaWxlKHZtLCAic2NyZWVuU2F2ZXIiLCAic2NyZWVuU2F2ZXJWaWRlbyIpOwogICAgICB9LAogICAgICBtYXhTaXplOiA1MDAgKiAxMDI0ICogMTAyNCwKICAgICAgZGVzY3JpcHRpb246IHZtLiR0KCJTY3JlZW5WaWRlb0Rlc2MiKQogICAgfSwgewogICAgICB0aXRsZTogdm0uJHQoIlBpY3R1cmVGaWxlcyIpLAogICAgICB0eXBlOiAic2VsZWN0IiwKICAgICAga2V5OiAicGljdHVyZUZpbGUiLAogICAgICB2YWx1ZTogdm0uc2NyZWVuU2F2ZXJQaWN0dXJlSXRlbXMubGVuZ3RoID09IDAgPyAiIiA6IHZtLnNjcmVlblNhdmVyUGljdHVyZUl0ZW1zWzBdLmtleSwKICAgICAgc2VsZWN0SXRlbXM6IHZtLnNjcmVlblNhdmVyUGljdHVyZUl0ZW1zLAogICAgICBzaG93QnRuOiB0cnVlLAogICAgICBvbkRlbDogZnVuY3Rpb24gb25EZWwodmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgIT0gIiIpIHsKICAgICAgICAgIG9uRGVsRmlsZSh2bSwgdmFsdWUsICJzY3JlZW5TYXZlciIsICJwaWN0dXJlRmlsZSIpOwogICAgICAgIH0KICAgICAgfSwKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIGRlbERpc2FibGVkOiB2bS5zY3JlZW5TYXZlclBpY3R1cmVJdGVtcy5sZW5ndGggPD0gMiwKICAgICAgZGVzY3JpcHRpb246IHZtLiR0KCJQaWN0dXJlRmlsZURlc2MiKQogICAgfSwgewogICAgICB0aXRsZTogdm0uJHQoIlZpZGVvRmlsZXMiKSwKICAgICAgaXNIaWRlOiB2bS5hcGlEYXRhLmRhdGEuaGFzQWtGYWNlID09ICIiLAogICAgICB0eXBlOiAic2VsZWN0IiwKICAgICAga2V5OiAidmlkZW9GaWxlIiwKICAgICAgdmFsdWU6IHZtLnNjcmVlblNhdmVyVmlkZW9JdGVtcy5sZW5ndGggPT0gMCA/ICIiIDogdm0uc2NyZWVuU2F2ZXJWaWRlb0l0ZW1zWzBdLmtleSwKICAgICAgc2VsZWN0SXRlbXM6IHZtLnNjcmVlblNhdmVyVmlkZW9JdGVtcywKICAgICAgc2hvd0J0bjogdHJ1ZSwKICAgICAgb25EZWw6IGZ1bmN0aW9uIG9uRGVsKHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlICE9ICIiKSB7CiAgICAgICAgICBvbkRlbEZpbGUodm0sIHZhbHVlLCAic2NyZWVuU2F2ZXIiLCAidmlkZW9GaWxlIik7CiAgICAgICAgfQogICAgICB9LAogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgZGVsRGlzYWJsZWQ6IHZtLnNjcmVlblNhdmVyVmlkZW9JdGVtcy5sZW5ndGggPT0gMCwKICAgICAgZGVzY3JpcHRpb246IHZtLiR0KCJWaWRlb0ZpbGVEZXNjIikKICAgIH0sIHsKICAgICAgdGl0bGU6IHZtLiR0KCJTY3JlZW5TYXZlclR5cGUiKSwKICAgICAgdHlwZTogInNlbGVjdCIsCiAgICAgIGtleTogIkNvbmZpZy5TZXR0aW5ncy5TQ1JFRU5TQVZFUi5TY3JlZXNhdmVyVHlwZSIsCiAgICAgIHZhbHVlOiB2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5TZXR0aW5ncy5TQ1JFRU5TQVZFUi5TY3JlZXNhdmVyVHlwZSJdLAogICAgICBzZWxlY3RJdGVtczogdm0uc2NyZWVuU2F2ZXJUeXBlSXRlbXMsCiAgICAgIGRlc2NyaXB0aW9uOiB2bS4kdCgiU2NyZWVuU2F2ZXJUeXBlRGVzYyIpCiAgICB9XQogIH07CiAgcmV0dXJuIGNvbnRlbnQ7Cn0KCmZ1bmN0aW9uIGNyZWF0ZU1vcmVwYWdlQ29udGVudCh2bSkgewogIC8vdGFibGUgZGF0YQogIHZhciB0YWJsZURhdGEgPSBbXTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCB2bS5hcGlEYXRhLmRhdGEucGFnZTJOdW07IGkrKykgewogICAgdmFyIGl0ZW0gPSB7CiAgICAgIGtleTogaSwKICAgICAgYXJlYTogdm0uJHQoIkFyZWEiKSArIChpICsgMSksCiAgICAgIHR5cGU6IHsKICAgICAgICB2YWx1ZTogdm0uYXBpRGF0YS5jb25maWdEYXRhWyJDb25maWcuSW5kb29yLlBBR0UyQVJFQSIgKyAoaSArIDEpICsgIi5EaXNwbGF5VHlwZSJdLAogICAgICAgIGlzV2FybjogZmFsc2UsCiAgICAgICAgd2FybkxhYmVsOiB2bS4kdCgiUGxlYXNlQ2hlY2tNdWx0aXBsaWNpdHkiKQogICAgICB9LAogICAgICB2YWx1ZTogewogICAgICAgIHZhbHVlOiB2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTJBUkVBIiArIChpICsgMSkgKyAiLlZhbHVlIl0sCiAgICAgICAgaXNXYXJuOiBmYWxzZSwKICAgICAgICB3YXJuTGFiZWw6IHZtLiR0KCJXYXJuSW52YWlsZEVtcHR5RXJyb3IiKSwKICAgICAgICBkaXNhYmxlZDogdHJ1ZSwKICAgICAgICBpdGVtVHlwZTogImlucHV0IgogICAgICB9LAogICAgICBsYWJlbDogewogICAgICAgIHZhbHVlOiB2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTJBUkVBIiArIChpICsgMSkgKyAiLkxBQkVMIl0sCiAgICAgICAgaXNXYXJuOiBmYWxzZSwKICAgICAgICB3YXJuTGFiZWw6ICIiLAogICAgICAgIGRpc2FibGVkOiBmYWxzZQogICAgICB9LAogICAgICBpY29uOiB7CiAgICAgICAgZmlsZURhdGE6IHt9LAogICAgICAgIC8vIGZpbGVOYW1lOiB2bS4kdCgiVXBncmFkZUZpbGVQYXRoIiksCiAgICAgICAgZmlsZU5hbWU6IHZtLmFwaURhdGEuY29uZmlnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMkFSRUEiICsgKGkgKyAxKSArICIuSUNPTiJdID09ICIiID8gdm0uJHQoIlVwZ3JhZGVGaWxlUGF0aCIpIDogdm0uYXBpRGF0YS5jb25maWdEYXRhWyJDb25maWcuSW5kb29yLlBBR0UyQVJFQSIgKyAoaSArIDEpICsgIi5JQ09OIl0sCiAgICAgICAgaXNTaG93OiB0cnVlCiAgICAgIH0KICAgIH07CiAgICB0YWJsZURhdGEucHVzaChpdGVtKTsKICB9IC8vY29udGVudAoKCiAgdmFyIGNvbnRlbnQgPSB7CiAgICBrZXk6ICJtb3JlcGFnZSIsCiAgICB0aXRsZTogdm0uJHQoIlBhZ2UyRGlzcGxheSIpLAogICAgdGl0bGVEZXNjcmlwdGlvbjogdm0uJHQoIk1vcmVQYWdlRGlzcGxheURlc2MiKSwKICAgIHNob3dFeGFtcGxlOiB0cnVlLAogICAgaW1nTmFtZTogIm1vcmVfcGFnZV9kZWZhdWx0LnBuZyIsCiAgICBpdGVtczogW3sKICAgICAgdHlwZTogInRhYmxlIiwKICAgICAga2V5OiAibW9yZXBhZ2UiLAogICAgICB0YWJsZURhdGE6IHRhYmxlRGF0YSwKICAgICAgdGFibGVDb2x1bW5zOiBbewogICAgICAgIHR5cGU6ICJsYWJlbCIsCiAgICAgICAgdGl0bGU6IHZtLiR0KCJBcmVhIiksCiAgICAgICAgZGF0YUluZGV4OiAiYXJlYSIsCiAgICAgICAgc2NvcGVkU2xvdHM6IHsKICAgICAgICAgIGN1c3RvbVJlbmRlcjogImFyZWEiCiAgICAgICAgfSwKICAgICAgICBhbGlnbjogImNlbnRlciIsCiAgICAgICAgd2lkdGg6ICIxMSUiCiAgICAgIH0sIHsKICAgICAgICB0eXBlOiAic2VsZWN0IiwKICAgICAgICB0aXRsZTogdm0uJHQoIlR5cGUiKSwKICAgICAgICBkYXRhSW5kZXg6ICJ0eXBlIiwKICAgICAgICBzY29wZWRTbG90czogewogICAgICAgICAgY3VzdG9tUmVuZGVyOiAidHlwZSIKICAgICAgICB9LAogICAgICAgIHNlbGVjdEl0ZW1zOiB2bS50eXBlMkl0ZW1zLAogICAgICAgIGFsaWduOiAiY2VudGVyIiwKICAgICAgICB3aWR0aDogIjE4JSIKICAgICAgfSwgewogICAgICAgIHR5cGU6ICJpbnB1dCIsCiAgICAgICAgdGl0bGU6IHZtLiR0KCJWYWx1ZSIpLAogICAgICAgIGRhdGFJbmRleDogInZhbHVlIiwKICAgICAgICBzY29wZWRTbG90czogewogICAgICAgICAgY3VzdG9tUmVuZGVyOiAidmFsdWUiCiAgICAgICAgfSwKICAgICAgICBhbGlnbjogImNlbnRlciIsCiAgICAgICAgd2lkdGg6ICIxOCUiLAogICAgICAgIG1heExlbmd0aDogMTI3LAogICAgICAgIHNlbGVjdEl0ZW1zOiB2bS5hcHBTZWxlY3RJdGVtcwogICAgICB9LCB7CiAgICAgICAgdHlwZTogImlucHV0IiwKICAgICAgICB0aXRsZTogdm0uJHQoIkxhYmVsIiksCiAgICAgICAgZGF0YUluZGV4OiAibGFiZWwiLAogICAgICAgIHNjb3BlZFNsb3RzOiB7CiAgICAgICAgICBjdXN0b21SZW5kZXI6ICJsYWJlbCIKICAgICAgICB9LAogICAgICAgIGFsaWduOiAiY2VudGVyIiwKICAgICAgICB3aWR0aDogIjE4JSIsCiAgICAgICAgbWF4TGVuZ3RoOiAxMjcKICAgICAgfSwgewogICAgICAgIHR5cGU6ICJmaWxlLWlucHV0IiwKICAgICAgICB0aXRsZTogdm0uJHQoIkljb25MYWJlbCIpICsgIigiICsgdm0uJHQoIk1heEljb25TaXplIikgKyAiOjEwMCoxMDApIiwKICAgICAgICBkYXRhSW5kZXg6ICJpY29uIiwKICAgICAgICBzY29wZWRTbG90czogewogICAgICAgICAgY3VzdG9tUmVuZGVyOiAiaWNvbiIKICAgICAgICB9LAogICAgICAgIGFsaWduOiAiY2VudGVyIiwKICAgICAgICB3aWR0aDogIjM1JSIsCiAgICAgICAgYnRuTmFtZTogdm0uJHQoIkRlbGV0ZUxhYmVsIiksCiAgICAgICAgYWNjZXB0RmlsZVR5cGU6ICIuanBnLC5wbmcsLmpwZWciLAogICAgICAgIHVwbG9hZDogZnVuY3Rpb24gdXBsb2FkKGZpbGVEYXRhLCBpbmRleCkgewogICAgICAgICAgcmV0dXJuIHVwbG9hZEljb24oZmlsZURhdGEsIGluZGV4LCB2bSk7CiAgICAgICAgfQogICAgICB9XQogICAgfV0KICB9OwogIHJldHVybiBjb250ZW50Owp9CgpmdW5jdGlvbiBjcmVhdGVIb21lcGFnZUNvbnRlbnQodm0pIHsKICAvL2RhdGEKICB2YXIgdGFibGVEYXRhID0gW107CgogIGZvciAodmFyIGkgPSAwOyBpIDwgdm0uYXBpRGF0YS5kYXRhLnBhZ2UxTnVtOyBpKyspIHsKICAgIHZhciBfaWNvbjsKCiAgICB2YXIgaXRlbSA9IHsKICAgICAga2V5OiBpLAogICAgICBhcmVhOiB2bS4kdCgiQXJlYSIpICsgKGkgKyAxKSwKICAgICAgdHlwZTogewogICAgICAgIHZhbHVlOiB2bS5hcGlEYXRhLmNvbmZpZ0RhdGFbIkNvbmZpZy5JbmRvb3IuUEFHRTFBUkVBIiArIChpICsgMSkgKyAiLkRpc3BsYXlUeXBlIl0sCiAgICAgICAgaXNXYXJuOiBmYWxzZSwKICAgICAgICB3YXJuTGFiZWw6IHZtLiR0KCJQbGVhc2VDaGVja011bHRpcGxpY2l0eSIpCiAgICAgIH0sCiAgICAgIHZhbHVlOiB7CiAgICAgICAgdmFsdWU6IHZtLmFwaURhdGEuY29uZmlnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMUFSRUEiICsgKGkgKyAxKSArICIuVmFsdWUiXSwKICAgICAgICBpc1dhcm46IGZhbHNlLAogICAgICAgIHdhcm5MYWJlbDogdm0uJHQoIldhcm5JbnZhaWxkRW1wdHlFcnJvciIpLAogICAgICAgIGRpc2FibGVkOiB0cnVlLAogICAgICAgIGl0ZW1UeXBlOiAiaW5wdXQiCiAgICAgIH0sCiAgICAgIGxhYmVsOiB7CiAgICAgICAgdmFsdWU6IHZtLmFwaURhdGEuY29uZmlnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMUFSRUEiICsgKGkgKyAxKSArICIuTEFCRUwiXSwKICAgICAgICBpc1dhcm46IGZhbHNlLAogICAgICAgIHdhcm5MYWJlbDogIiIsCiAgICAgICAgZGlzYWJsZWQ6IGZhbHNlCiAgICAgIH0sCiAgICAgIGljb246IChfaWNvbiA9IHsKICAgICAgICBmaWxlRGF0YToge30sCiAgICAgICAgZmlsZU5hbWU6IHZtLiR0KCJVcGdyYWRlRmlsZVBhdGgiKQogICAgICB9LCBfZGVmaW5lUHJvcGVydHkoX2ljb24sICJmaWxlTmFtZSIsIHZtLmFwaURhdGEuY29uZmlnRGF0YVsiQ29uZmlnLkluZG9vci5QQUdFMUFSRUEiICsgKGkgKyAxKSArICIuSUNPTiJdID09ICIiID8gdm0uJHQoIlVwZ3JhZGVGaWxlUGF0aCIpIDogdm0uYXBpRGF0YS5jb25maWdEYXRhWyJDb25maWcuSW5kb29yLlBBR0UxQVJFQSIgKyAoaSArIDEpICsgIi5JQ09OIl0pLCBfZGVmaW5lUHJvcGVydHkoX2ljb24sICJpc1Nob3ciLCB0cnVlKSwgX2ljb24pCiAgICB9OwogICAgdGFibGVEYXRhLnB1c2goaXRlbSk7CiAgfSAvL2NvbnRlbnQKCgogIHZhciBjb250ZW50ID0gewogICAga2V5OiAiaG9tZXBhZ2UiLAogICAgdGl0bGU6IHZtLiR0KCJQYWdlMURpc3BsYXkiKSwKICAgIHRpdGxlRGVzY3JpcHRpb246IHZtLiR0KCJIb21lUGFnZURpc3BsYXlEZXNjIiksCiAgICBzaG93RXhhbXBsZTogdHJ1ZSwKICAgIGltZ05hbWU6ICJob21lX3BhZ2VfZGVmYXVsdC5wbmciLAogICAgaXRlbXM6IFt7CiAgICAgIHR5cGU6ICJ0YWJsZSIsCiAgICAgIGtleTogImhvbWVwYWdlIiwKICAgICAgdGFibGVEYXRhOiB0YWJsZURhdGEsCiAgICAgIHRhYmxlQ29sdW1uczogW3sKICAgICAgICB0eXBlOiAibGFiZWwiLAogICAgICAgIHRpdGxlOiB2bS4kdCgiQXJlYSIpLAogICAgICAgIGRhdGFJbmRleDogImFyZWEiLAogICAgICAgIHNjb3BlZFNsb3RzOiB7CiAgICAgICAgICBjdXN0b21SZW5kZXI6ICJhcmVhIgogICAgICAgIH0sCiAgICAgICAgYWxpZ246ICJjZW50ZXIiLAogICAgICAgIHdpZHRoOiAiMTElIgogICAgICB9LCB7CiAgICAgICAgdHlwZTogInNlbGVjdCIsCiAgICAgICAgdGl0bGU6IHZtLiR0KCJUeXBlIiksCiAgICAgICAgZGF0YUluZGV4OiAidHlwZSIsCiAgICAgICAgc2NvcGVkU2xvdHM6IHsKICAgICAgICAgIGN1c3RvbVJlbmRlcjogInR5cGUiCiAgICAgICAgfSwKICAgICAgICBzZWxlY3RJdGVtczogdm0udHlwZUl0ZW1zLAogICAgICAgIGFsaWduOiAiY2VudGVyIiwKICAgICAgICB3aWR0aDogIjE4JSIKICAgICAgfSwgewogICAgICAgIHR5cGU6ICJpbnB1dCIsCiAgICAgICAgdGl0bGU6IHZtLiR0KCJWYWx1ZSIpLAogICAgICAgIGRhdGFJbmRleDogInZhbHVlIiwKICAgICAgICBzY29wZWRTbG90czogewogICAgICAgICAgY3VzdG9tUmVuZGVyOiAidmFsdWUiCiAgICAgICAgfSwKICAgICAgICBhbGlnbjogImNlbnRlciIsCiAgICAgICAgd2lkdGg6ICIxOCUiLAogICAgICAgIG1heExlbmd0aDogMTI3LAogICAgICAgIHNlbGVjdEl0ZW1zOiB2bS5hcHBTZWxlY3RJdGVtcwogICAgICB9LCB7CiAgICAgICAgdHlwZTogImlucHV0IiwKICAgICAgICB0aXRsZTogdm0uJHQoIkxhYmVsIiksCiAgICAgICAgZGF0YUluZGV4OiAibGFiZWwiLAogICAgICAgIHNjb3BlZFNsb3RzOiB7CiAgICAgICAgICBjdXN0b21SZW5kZXI6ICJsYWJlbCIKICAgICAgICB9LAogICAgICAgIGFsaWduOiAiY2VudGVyIiwKICAgICAgICB3aWR0aDogIjE4JSIsCiAgICAgICAgbWF4TGVuZ3RoOiAxMjcKICAgICAgfSwgewogICAgICAgIHR5cGU6ICJmaWxlLWlucHV0IiwKICAgICAgICB0aXRsZTogdm0uJHQoIkljb25MYWJlbCIpICsgIigiICsgdm0uJHQoIk1heEljb25TaXplIikgKyAiOjEwMCoxMDApIiwKICAgICAgICBkYXRhSW5kZXg6ICJpY29uIiwKICAgICAgICBzY29wZWRTbG90czogewogICAgICAgICAgY3VzdG9tUmVuZGVyOiAiaWNvbiIKICAgICAgICB9LAogICAgICAgIGFsaWduOiAiY2VudGVyIiwKICAgICAgICB3aWR0aDogIjM1JSIsCiAgICAgICAgYnRuTmFtZTogdm0uJHQoIkRlbGV0ZUxhYmVsIiksCiAgICAgICAgYWNjZXB0RmlsZVR5cGU6ICIuanBnLC5wbmcsLmpwZWciLAogICAgICAgIHVwbG9hZDogZnVuY3Rpb24gdXBsb2FkKGZpbGVEYXRhLCBpbmRleCkgewogICAgICAgICAgcmV0dXJuIHVwbG9hZEljb24oZmlsZURhdGEsIGluZGV4LCB2bSk7CiAgICAgICAgfQogICAgICB9XQogICAgfV0KICB9OwogIHJldHVybiBjb250ZW50Owp9CgpmdW5jdGlvbiB1cGxvYWRJY29uKGZpbGVEYXRhLCBpbmRleCwgdm0pIHsKICB2YXIgZmlsZU5hbWUgPSBmaWxlRGF0YS5uYW1lOwoKICBpZiAoZmlsZU5hbWUgPT0gIiIgfHwgZmlsZU5hbWUgPT0gdm0uJHQoIlVwZ3JhZGVGaWxlUGF0aCIpKSB7CiAgICBzaG93RXJyb3JJbmZvKHZtLCB2bS4kdCgiRmlsZUVtcHR5V2FybmluZyIpKTsKICAgIHJldHVybjsKICB9IC8v56Gu6K6k5Zu+54mH5YiG6L6o546HCgoKICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlRGF0YSk7CgogIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7CiAgICBpbWcuc3JjID0gcmVhZGVyLnJlc3VsdDsKCiAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAvL+WIhui+qOeOh+i2heWHugogICAgICBpZiAoaW1nLndpZHRoID4gMTAwIHx8IGltZy5oZWlnaHQgPiAxMDApIHsKICAgICAgICBzaG93RXJyb3JJbmZvKHZtLCB2bS4kdCgiSW1hZ2VSZXNvbHV0aW9uRXJyIikpOwogICAgICAgIHZhciBpdGVtID0gZ2V0SXRlbUJ5S2V5KHZtLmRhdGEsICJob21lcGFnZSIsICJob21lcGFnZSIpOwogICAgICAgIGl0ZW0udGFibGVEYXRhW2luZGV4XS5pY29uID0gewogICAgICAgICAgZmlsZURhdGE6IHt9LAogICAgICAgICAgZmlsZU5hbWU6IHZtLiR0KCJVcGdyYWRlRmlsZVBhdGgiKQogICAgICAgIH07CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8v5q2j5bi45LiK5LygCgoKICAgICAgdmFyIHVwRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICB1cERhdGEuYXBwZW5kKCJmaWxlIiwgZmlsZURhdGEpOwogICAgICBheGlvcy5wb3N0KCJhcGkvcGhvbmVEaXNwbGF5U2V0dGluZy91cGxvYWQ/dHlwZT1hcmVhSWNvbiIsIHVwRGF0YSwgewogICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICJDb250ZW50LVR5cGUiOiAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIKICAgICAgICB9CiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykge30pOwogICAgfTsKCiAgICBpbWcub25lcnJvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgLy/lm77niYfliqDovb3plJnor68KICAgICAgc2hvd0Vycm9ySW5mbyh2bSwgdm0uJHQoIkZpbGVGb3JtYXRXYXJuaW5nIikpOwogICAgICB2YXIgaXRlbSA9IGdldEl0ZW1CeUtleSh2bS5kYXRhLCAiaG9tZXBhZ2UiLCAiaG9tZXBhZ2UiKTsKICAgICAgaXRlbS50YWJsZURhdGFbaW5kZXhdLmljb24gPSB7CiAgICAgICAgZmlsZURhdGE6IHt9LAogICAgICAgIGZpbGVOYW1lOiB2bS4kdCgiVXBncmFkZUZpbGVQYXRoIikKICAgICAgfTsKICAgIH07CiAgfTsKfQoKZnVuY3Rpb24gdXBsb2FkRmlsZSh2bSwgY29udGVudEtleSwgaXRlbUtleSkgewogIHZhciBpdGVtID0gZ2V0SXRlbUJ5S2V5KHZtLmRhdGEsIGNvbnRlbnRLZXksIGl0ZW1LZXkpOwogIHZhciBmaWxlTmFtZSA9IGl0ZW0udmFsdWUuZmlsZU5hbWU7CgogIGlmIChmaWxlTmFtZSA9PSAiIiB8fCBmaWxlTmFtZSA9PSB2bS4kdCgiVXBncmFkZUZpbGVQYXRoIikpIHsKICAgIHNob3dFcnJvckluZm8odm0sIHZtLiR0KCJGaWxlRW1wdHlXYXJuaW5nIikpOwogICAgcmV0dXJuOwogIH0KCiAgdmFyIGNvbmZpcm1UZXh0ID0gdm0uJHQoIkltcG9ydFdhbGxwYXBlcldhcm5pbmciKTsKCiAgaWYgKGNvbnRlbnRLZXkgPT0gInNjcmVlblNhdmVyIikgewogICAgY29uZmlybVRleHQgPSB2bS4kdCgiSW1wb3J0U2NyZWVuU2F2ZXJXYXJuaW5nIik7CiAgfSBlbHNlIGlmIChjb250ZW50S2V5ID09ICJib290TG9nbyIpIHsKICAgIGNvbmZpcm1UZXh0ID0gdm0uJHQoIlVwbG9hZExvZ29XYXJuaW5nIik7CiAgfQoKICBpdGVtLnZpc2libGUgPSB0cnVlOwoKICBpZiAoY29uZmlybShjb25maXJtVGV4dCkpIHsKICAgIC8v5LiK5LygCiAgICBpdGVtLmxvYWRpbmcgPSB0cnVlOwogICAgdmFyIHVwRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgdXBEYXRhLmFwcGVuZCgiZmlsZSIsIGl0ZW0udmFsdWUuZmlsZURhdGEpOwogICAgdmFyIGFwaVVybCA9ICJhcGkvcGhvbmVEaXNwbGF5U2V0dGluZy91cGxvYWQ/dHlwZT0iICsgaXRlbUtleTsKCiAgICBpZiAoaXRlbUtleSA9PSAiYm9vdExvZ29VcGxvYWQiKSB7CiAgICAgIGFwaVVybCArPSAiJndpZHRoPSIgKyBpdGVtLnZhbHVlLmZpbGVEYXRhLndpZHRoICsgIiZoZWlnaHQ9IiArIGl0ZW0udmFsdWUuZmlsZURhdGEuaGVpZ2h0OwogICAgfQoKICAgIGF4aW9zLnBvc3QoYXBpVXJsLCB1cERhdGEsIHsKICAgICAgaGVhZGVyczogewogICAgICAgICJDb250ZW50LVR5cGUiOiAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIKICAgICAgfQogICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgIGlmIChyZXMuZGF0YS5yZXRjb2RlID09IC0xKSB7CiAgICAgICAgc2hvd0Vycm9ySW5mbyh2bSwgdm0uJHQoIkZpbGVVcGxvYWRGYWlsZWRXYXJuaW5nIikpOwogICAgICB9IGVsc2UgaWYgKHJlcy5kYXRhLnJldGNvZGUgPT0gMCkgewogICAgICAgIGdldERhdGEodm0pOwogICAgICAgIHNob3dSZXF1ZXN0U3VjY2Vzcyh2bSwgdm0uJHQoIlVwbG9hZEZpbGVGaW5pc2hlZCIpKTsKICAgICAgICBpdGVtLnZpc2libGUgPSBmYWxzZTsKICAgICAgICBpdGVtLnZhbHVlLmZpbGVOYW1lID0gdm0uJHQoIlVwZ3JhZGVGaWxlUGF0aCIpOwogICAgICAgIGl0ZW0udmFsdWUuZmlsZURhdGEgPSB7fTsKICAgICAgfQoKICAgICAgaXRlbS5sb2FkaW5nID0gZmFsc2U7CiAgICB9KTsKICB9Cn0KCmZ1bmN0aW9uIG9uRGVsRmlsZSh2bSwgdmFsdWUsIGNvbnRlbnRLZXksIGl0ZW1LZXkpIHsKICB2YXIgcmVhbEl0ZW1LZXkgPSBpdGVtS2V5ID09ICJ3YWxscGFwZXJEZWwiID8gIkNvbmZpZy5TZXR0aW5ncy5MT0dPLldhbGxwYXBlciIgOiBpdGVtS2V5OwogIHZhciByZXF1ZXN0RGF0YSA9IHsKICAgIHRhcmdldDogInBob25lRGlzcGxheVNldHRpbmciLAogICAgYWN0aW9uOiAiZGVsIiwKICAgIGRhdGE6IHsKICAgICAgZmlsZU5hbWU6IHZhbHVlLAogICAgICB0eXBlOiBpdGVtS2V5CiAgICB9CiAgfTsKCiAgaWYgKGl0ZW1LZXkgPT0gImJvb3RMb2dvVXBsb2FkIikgewogICAgaWYgKCFjb25maXJtKHZtLiR0KCJEZWxldGVMb2dvQ29uZmlybSIpKSkgewogICAgICByZXR1cm47CiAgICB9CiAgfSBlbHNlIHsKICAgIGlmICghY29uZmlybSh2bS4kdCgiRGVsZXRlU2VsZWN0ZWRDb25maXJtIikpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICB9CgogIGdldEl0ZW1CeUtleSh2bS5kYXRhLCBjb250ZW50S2V5LCByZWFsSXRlbUtleSkubG9hZGluZyA9IHRydWU7CiAgdm0uJGF4aW9zLnBvc3QoImFwaSIsIHJlcXVlc3REYXRhKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgZ2V0SXRlbUJ5S2V5KHZtLmRhdGEsIGNvbnRlbnRLZXksIHJlYWxJdGVtS2V5KS5sb2FkaW5nID0gZmFsc2U7CiAgICBnZXREYXRhKHZtKTsKICAgIHNob3dSZXF1ZXN0U3VjY2Vzcyh2bSk7CiAgfSk7Cn0="},null]}